(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[32],{1371:function(C,F,b){function a(Ob){return Qe.call(this,Ob)||this}function e(Ob){this.$=Ob}function d(Ob){var yc=pd.call(this)||this;yc.$=Ob;yc.Yb();return yc}function l(Ob,yc,id,Tc,od){var mc=Zc.call(this)||this;mc.statusBarManager=null;mc.MSc=!1;mc.I8=null;mc.rwc=!1;mc.KGd=null;mc.Ija=null;mc.Gwd=!1;mc.Sn=!1;mc.Uo=null;mc.W6d=null;mc.cea=null;mc.Q5d=null;mc.bCa=null;mc.$=Tc;mc.zr=Ob;mc.mD=id;mc.ha=od;mc.zr.dge(Object(ta.a)(mc,
mc.QKd,"showPolicyBusinessBar"));mc.dV=yc;return mc}function n(Ob){return Fc.call(this,Ob,n.xP(Ob))||this}function r(Ob,yc,id,Tc,od){var mc=ng.call(this)||this;mc.Vef=3;mc.augmentationLoopManager=null;mc.Az=null;mc.PWa=!1;mc.c7a=[];mc.Y$e=new pc.a(xc.a.RL());mc.Txd=0;mc.Yxd=null;mc.Fwd=Ob;mc.policyManager=yc;mc.$=id;mc.ha=Tc;mc.businessBar=od;mc.YTh();mc.QPi();mc.disposed=!1;return mc}function h(){var Ob=me.call(this)||this;Ob.classificationId=null;Ob.H_=Object.assign(new ee.a,{T_:h.getTypeName(),
B_:h.ke()});return Ob}function v(){var Ob=Ve.call(this)||this;Ob.recommended=null;Ob.automatic=null;Ob.source=null;Ob.H_=Object.assign(new ee.a,{T_:v.getTypeName(),B_:v.ke()});return Ob}function w(){var Ob=t.call(this)||this;Ob.existingLabelPriority=null;Ob.H_=Object.assign(new ee.a,{T_:w.getTypeName(),B_:w.ke()});return Ob}function t(){var Ob=se.call(this)||this;Ob.partialDocSITs=null;Ob.fullDocSITs=null;Ob.H_=Object.assign(new ee.a,{T_:t.getTypeName(),B_:t.ke()});return Ob}function B(){var Ob=ne.call(this)||
this;Ob.recommended=null;Ob.automatic=null;Ob.source=null;Ob.H_=Object.assign(new ee.a,{T_:B.getTypeName(),B_:B.ke()});return Ob}function z(Ob,yc,id,Tc,od,mc,Le){Le=Ob.Na(1,void 0===Le?null:Le);Le.tenantId=yc;return ld.i(Ob,"GetPolicyApplicationMethod",Le,id,Tc,od,mc,4)}function x(Ob,yc,id,Tc,od,mc,Le){Le=Ob.Na(1,void 0===Le?null:Le);Le.tenantId=yc;return ld.i(Ob,"GetPolicyLabelId",Le,id,Tc,od,mc,4)}function y(){this.rWa=this.annotationType=null;this.HJa=this.dE=!1}function J(){this.Dkc=this.DMf=
null;this.qO=0}function E(){this.j0=this.Yoa=this.Za=this.Wg=null}function A(Ob,yc,id,Tc,od){Tc=void 0===Tc?0:Tc;od=void 0===od?null:od;this.yBc=this.WYd=null;this.tpa=this.yfb=this.Afb=0;this.Q6="";this.WCa=this.szc=this.c1d=this.sna=this.bHc=null;this.E1d=!1;this.CAa=null;this.bEc=0;this.dRb=this.YCa=this.HBa=this.cRb=null;this.Ya=new Jb.a;this.FGb=this.Dsb=this.TCa=null;this.NEc=!1;this.Axb=null;this.vb=Ob;this.Ng=yc;this.jh=id;this.dQb=Tc;this.an=new da;this.U6d=this.vb.Ta("PolicyHandlerEndpointName")||
"PolicyHandler.ashx";this.NN=od;this.avb=Ob.sa("WacApplyManualPolicyLabelIsEnabled");this.ibc=Ob.sa("CoAuthForProtectedFilesIsEnabled");this.supportsOfficeClientCoauthoring=Ob.sa("SupportsOfficeClientCoauthoring");this.n6h=!1;this.A9i=3E4;this.fe=yd.a.instance;Ob.sa("SupportsPolicies")&&oc.a("MipSupportsPolicies");this.ibc&&this.supportsOfficeClientCoauthoring&&oc.a("MipSupportsOfficeClientCoauthoring")}function H(){}function S(Ob,yc,id,Tc,od,mc,Le,we,za,Nb,bb,Ub,kc,ad,Qd,We,Ke,nf,Pe,hf,Vf){this.url=
Ob;this.pBj=yc;this.body=id;this.headers=Tc;this.X$a=od;this.priority=mc;this.state=Le;this.z5f=void 0===we?null:we;this.FQ=void 0===za?null:za;this.uU=void 0===Nb?!1:Nb;this.hLi=void 0===bb?null:bb;this.n5i=void 0===Ub?null:Ub;this.name=void 0===kc?null:kc;this.KBb=void 0===ad?null:ad;this.Q6c=void 0===Qd?!1:Qd;this.Xuf=void 0===We?null:We;this.I4b=void 0===Ke?null:Ke;this.Pac=void 0===nf?null:nf;this.F9a=void 0===Pe?null:Pe;this.$Rh=void 0===hf?null:hf;this.responseType=void 0===Vf?null:Vf}function Q(Ob){var yc=
Lc.call(this)||this;yc.Jdj=Ob;return yc}function L(Ob){var yc=gc.call(this)||this;yc.Sxg=Ob;return yc}function aa(Ob,yc,id,Tc,od,mc,Le){Tc=void 0===Tc?null:Tc;od=void 0===od?null:od;mc=void 0===mc?null:mc;Le=void 0===Le?null:Le;var we=Ab.call(this)||this;we.errorType=Ob;we.Sxg=yc;we.sTf=id;we.title=Tc;we.message=od;we.buttonText=mc;we.yX=Le;return we}function fa(Ob,yc){var id=cb.call(this)||this;id.Dkc=Ob;id.qO=yc;return id}function W(){return Qa.call(this)||this}function G(Ob,yc){var id=fb.call(this)||
this;id.emb=Ob;id.lwb=yc;return id}function N(Ob,yc,id,Tc){var od=sb.call(this)||this;od.title=Ob;od.Ekc=yc;od.buttonText=id;od.nkf=Tc;return od}function Y(Ob,yc){var id=jc.call(this)||this;id.Ija=Ob;id.eie=yc;return id}function V(Ob){Ob=void 0===Ob?!1:Ob;var yc=Db.call(this)||this;yc.onSuccess=Ob;return yc}function da(){this.AreLabelsAvailable=!1;this.AppliedPolicyId=null;this.MandatoryLabelingEnforced=this.RequiredDowngradeJustification=!1;this.SensitivityLabels=this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=
this.CustomUrl=this.DefaultLabelId=null;this.AreLabelsAvailable=!1;this.AppliedPolicyId="";this.RequiredDowngradeJustification=!1;this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.DefaultLabelId="";this.SensitivityLabels=[];this.MandatoryLabelingEnforced=!1;this.CustomUrl=""}function U(){return Hb.call(this)||this}function Z(Ob){var yc=Qb.call(this)||this;yc.sFj=Ob;return yc}function ca(Ob,yc,id){var Tc=Sa.call(this)||this;Tc.Gre=Ob;Tc.Fre=yc;Tc.existingLabelPriority=id;return Tc}
function ra(Ob,yc,id,Tc,od){var mc=ua.call(this)||this;mc.emb=Ob;mc.title=yc;mc.message=id;mc.buttonText=Tc;mc.yX=od;return mc}function La(Ob,yc,id,Tc,od,mc){var Le=$a.call(this)||this;Le.emb=Ob;Le.title=yc;Le.message=id;Le.buttonText=Tc;Le.yX=od;Le.lwb=mc;return Le}function na(Ob,yc,id,Tc){this.MPb=this.oGc=null;this.GFc=this.ZFc=this.kgb=this.Y3d=this.CBc=!1;this.GSa=this.zda=this.vea=this.wna=this.IPb=this.Wu=this.L7=this.Hg=null;this.yzc=0;this.HZd=this.WFc=this.Izc=null;this.La=Ob;this.Ce=yc;
this.vb=id;this.Wg=Tc;this.Ugb={};this.V6d={};this.Z3d={};this.avb=id.sa("WacApplyManualPolicyLabelIsEnabled");this.Wg.value.vge(Object(ta.a)(this,this.qyd,"processAutoSensitivityLabel"));this.Wg.value.ZPc(Object(ta.a)(this,this.qyd,"processAutoSensitivityLabel"));this.Wg.value.DPc(Object(ta.a)(this,this.cBi,"onUpdateLabelInfo"));Ga.AFrameworkApplication.xa&&Ga.AFrameworkApplication.xa.itg(Object(ta.a)(this,this.wPi,"refreshDocumentPolicyLabelsOnModeChange"));id.sa("SupportsPolicies")&&id.Ta("AppliedPolicyId")&&
(this.oGc=id.Ta("IrmPolicyTitle"),this.MPb=id.Ta("IrmPolicyDescription"));this.s7d=id.sa("ProtectedFile");this.e$f=this.vb.xd("SetPolicyLabelAwaitFileExistsOnHostMaxRetries",6);this.f$f=this.vb.xd("SetPolicyLabelAwaitFileExistsOnHostRetryDelayMs",5E3)}function ma(){}function xa(){this.ggb=!!Ga.AFrameworkApplication.xa&&Ga.AFrameworkApplication.xa.Xa.qu}function Pa(Ob,yc,id){var Tc=Tb.call(this,!1,!1,!0)||this;if(!Ob||!id)return ea.ULS.sendTraceTag(560547850,306,10,"MandatoryLabelingDialog was triggered with invalid inputs"),
Tc;var od={};od=(od.id="MandatoryLabellingDialog",od);Tc.sbg=id;Tc.OGc=yc;if(!Ga.AFrameworkApplication.ha.sa("MandatoryLabelingDialogLearnMoreSwitchIsEnabled")||Tc.OGc&&""!==Tc.OGc)yc={},yc=(yc.href=Tc.OGc,yc.target="_blank",yc),id={},od.learnMoreLink=(id.type="AppLinkProps",id.id="mandatoryLabellingLearnMoreLink",id.text=CommonUIStrings.l_LearnMore,id.handler=yc,id.customTooltip=CommonUIStrings.L_LearnMoreTooltip,id);yc={};Ob=(yc.id="mandatoryLabellingFlyoutMenuSection",yc.controls=Ob,yc);yc={};
yc=(yc.sections=[],yc.shouldAutoOpen=!1,yc);Array.add(yc.sections,Ob);Ob={};od.labelFlyout=(Ob.type="AppFlyoutAnchorProps",Ob.id="mandatoryLabellingFyout",Ob.label="Pick a label",Ob.hideLabel=!1,Ob.hideChevron=!1,Ob.hideIcon=!0,Ob.menuDefinition=yc,Ob);Ob={};Ob=(Ob.id="MandatoryLabellingDialog",Ob.bodyControls=od,Ob);od.initialLabelText=CommonUIStrings.l_MandatoryLabellingDialogInitialLabelText;od.descriptionText=CommonUIStrings.l_MandatoryLabellingDialogDescriptionText;Tc.initializeAndShow(CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,
Object(ta.a)(Tc,Tc.cgi,"mandatoryLabellingDialogHandler"),Ob);return Tc}function ib(Ob,yc){var id=kb.call(this,!1,!1,ib.Cx)||this;id.qoa=[CommonUIStrings.l_SensitivityJustificationNoLongerApplies,CommonUIStrings.l_SensitivityJustificationIncorrect,CommonUIStrings.l_SensitivityJustificationOther];id.oRb=null;id.nRb=!1;id.v9d=Ob;id.zK=yc;id.tf=id.CDg();id.hc=1;id.Ie=ib.id;id.yc(1,CommonUIStrings.l_DialogChange);id.kK(1,!1);id.Ela(0);return id}function pb(){}function xb(Ob,yc){this.qO=Ob;this.displayName=
yc}function Ya(Ob,yc,id){id=void 0===id?null:id;this.id=Ob.Id;id||(id="");this.BOi=id;this.sensitivityLabel=Ob}b.r(F);var ab=b(0),ea=b(15),ta=b(37),Ka=b(975),mb=b(211);Object(ab.a)(Ya,"AutoPolicyLabelData",null,[]);Object(ab.a)(xb,"PolicyLabelRequestState",null,[]);var Ha=b(140),Ga=b(5),Fa=b(365),eb=b(13),db=b(40),Na=b(30);Ll.Object.defineProperties(pb,{wld:{configurable:!0,enumerable:!0,get:function(){return pb.o9h}}});pb.o9h="<div class='WACDialogRow' id='JustificationMessageBlock'> <div class='WACDialogIcon' id='JustificationIconArea'> <div class='clip32x32' id='JustificationIconClip' unselectable='on' style='z-index: 0; display: inline-block;'> <img id='iconJustification' class='{1}' role='presentation' src={0} /> </div> </div> <div class='WACDialogTextPanel WACJustificationDialogMessage' id='JustificationMessageArea'> <label id='messageJustification' class='WACDialogLabel' >{2}</label> </div> </div> <br/> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock0'> <input type='radio' id='radiobox0' name='ListRadioBox' class='WACDialogRadio' alt='{3}' title='{3}'></input> <label id='JustificationDlgList0' class='WACDialogLabel' for='radiobox0' >{3}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock1'> <input type='radio' id='radiobox1' name='ListRadioBox' class='WACDialogRadio' alt='{4}' title='{4}'></input> <label id='JustificationDlgList1' class='WACDialogLabel' for='radiobox1' >{4}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock2'> <input type='radio' id='radiobox2' name='ListRadioBox' class='WACDialogRadio' alt='{5}' title='{5}'></input> <label id='JustificationDlgList2' class='WACDialogLabel' for='radiobox2' >{5}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow WACJustificationDialogTextAreaRow' id='JustificationTextAreaBlock'> <textarea id='txtJustification' class='JustificationTextArea' placeholder='{6}' style='border:solid 1px grey;resize:none;' autocomplete=\"off\"></textarea> </div>";
Object(ab.a)(pb,"JustificationDialogHtml",null,[]);var kb=Ha.a;Em(ib,kb);ib.prototype.GKd=function(){if(ib.Cx)this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,Object(ta.a)(this,this.lBf,"reactJustificationDialogHandler"),this.LTe(this.nRb));else{for(var Ob={},yc=0;yc<this.qoa.length;yc++)Ob[ib.Xyd+yc]=!1;Ob[ib.YIb]="";this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,Object(ta.a)(this,this.n9h,"justificationDialogHandler"),Ob);this.iQi();db.a.addHandler($get(ib.YIb),
eb.a.input,Object(ta.a)(this,this.Soj,"textAreaHandler"))}};ib.prototype.validate=function(){if(ib.Cx)return this.F4f(this.oRb);var Ob=$get(ib.YIb);return Ob.disabled?!0:this.F4f(Ob.value)};ib.prototype.F4f=function(Ob){var yc=2>Ob.length,id=500<Ob.length,Tc=RegExp("[{|}|;|\\\\]").test(Ob);Ob=""===Na.a.Amc(Ob);return!yc&&!id&&!Tc&&!Ob};ib.prototype.n9h=function(Ob,yc){var id="";if(1===Ob)for(var Tc=0;Tc<this.qoa.length;Tc++)if(yc[ib.Xyd+Tc]){id=Tc===this.qoa.length-1?yc[ib.YIb]:this.qoa[Tc];break}this.zK(Ob,
this.v9d,id)};ib.prototype.lBf=function(Ob){var yc="";1===Ob&&this.oRb&&(yc=this.oRb);this.zK(Ob,this.v9d,yc)};ib.prototype.jvi=function(Ob){this.oRb=Ob;Ob=this.validate();this.nRb!==Ob&&(this.nRb=Ob,this.Svc(CommonUIStrings.l_SensitivityJustificationTitle,Object(ta.a)(this,this.lBf,"reactJustificationDialogHandler"),this.LTe(this.nRb)))};ib.prototype.LTe=function(Ob){var yc={},id={},Tc={},od={};return od.id=this.Ie,od.bodyControls=(id.choiceGroupProps={},id.textAreaProps=(yc.placeholder=CommonUIStrings.l_SensitivityJustificationPlaceholder,
yc),id),od.actionButtonProps=(Tc.label=CommonUIStrings.l_DialogChange,Tc.disabled=!Ob,Tc),od.infoMessage=CommonUIStrings.l_SensitivityJustificationMessage,od.justificationIrrelevantLabel=CommonUIStrings.l_SensitivityJustificationNoLongerApplies,od.justificationIncorrectLabel=CommonUIStrings.l_SensitivityJustificationIncorrect,od.justificationOtherLabel=CommonUIStrings.l_SensitivityJustificationOther,od.onJustificationUpdated=Object(ta.a)(this,this.jvi,"onJustificationUpdated"),od};ib.prototype.Soj=
function(Ob){Ob.target&&this.kK(1,this.validate())};ib.prototype.CDg=function(){return Ha.a.$i(ib.wld,Ga.AFrameworkApplication.WB,Fa.getImageClass(ib.iconName),CommonUIStrings.l_SensitivityJustificationMessage,this.qoa[0],this.qoa[1],this.qoa[2],CommonUIStrings.l_SensitivityJustificationPlaceholder)};ib.prototype.iQi=function(){for(var Ob=document.getElementsByName(ib.Eai),yc=0;yc<Ob.length;yc++)db.a.addHandler(Ob[yc],eb.a.focus,Object(ta.a)(this,this.Tzf,"radioButtonFocusHandler")),db.a.addHandler(Ob[yc],
eb.a.click,Object(ta.a)(this,this.Tzf,"radioButtonFocusHandler"))};ib.prototype.Tzf=function(Ob){if(Ob=Ob.target){Ob.checked=!0;var yc=$get(ib.YIb);Ob.id===ib.Xyd+(this.qoa.length-1)?(yc.disabled=!1,Sys.UI.DomElement.setVisible(yc,!0),yc.focus()):(yc.disabled=!0,Ob.focus());this.kK(1,this.validate())}};Ll.Object.defineProperties(ib,{Cx:{configurable:!0,enumerable:!0,get:function(){return Ga.AFrameworkApplication.xa.Xa.qu&&Ga.AFrameworkApplication.xa.Xa.F7e}}});ib.wld=pb.wld;ib.Eai="ListRadioBox";
ib.Xyd="radiobox";ib.YIb="txtJustification";ib.iconName="Info_32x32x32";ib.id="JustificationDialog";Object(ab.a)(ib,"JustificationDialog",Ha.a,[]);var Tb=Ha.a;Em(Pa,Tb);Pa.prototype.cgi=function(Ob,yc){1===Ob&&yc.selectedLabel&&(Ob=yc.selectedLabel,""!==Ob&&this.sbg(Ob))};Object(ab.a)(Pa,"MandatoryLabellingDialog",Ha.a,[]);xa.prototype.pVg=function(Ob,yc,id){this.ggb&&new Pa(Ob,yc,id)};Ll.Object.defineProperties(xa,{instance:{configurable:!0,enumerable:!0,get:function(){return xa.Ma||(xa.Ma=new xa)}}});
xa.Ma=null;Object(ab.a)(xa,"MandatoryLabellingDialogFactory",null,[288]);ma.Vlj="sbProtectForm14";ma.Ylj="SBStatusBarMarkAsReadOnly14";ma.Q$h="Info_16x16x32";ma.Pmb="QuickSearchCompletedToday_16x16x32";ma.wzd="CommonControlCheckboxCheck_16";ma.oZf="On";ma.visible="Visible";ma.loh="ImageIsVisible";ma.EH="SourceControlId";ma.menuItemId="MenuItemId";ma.menu="Menu";ma.NQc="AppLockId";ma.value="Value";ma.Qi="LabelText";ma.alt="Alt";ma.x0e="Image16by16";ma.u2a="Image16by16Class";ma.Ulj="SBProtectForm_16";
ma.Xlj="SBStatusBarMarkAsReadOnly_16";ma.icon="Icon";ma.iconColor="IconColor";ma.customTooltip="CustomTooltip";ma.HNi="MipTagOutline_24";ma.ENi="MipTagFilled_24";ma.GNi="MipTagLockOutline_24";ma.FNi="MipTagLockFilled_24";ma.DNi="MipTagError_24";ma.INi="MipTagQuestion_24";ma.tye="#000000";ma.Amj="No Label";ma.Bmj="Select A Label";Object(ab.a)(ma,"PolicyConstants",null,[]);var ha=b(982),lb=b(828),Wa=b(806),Ra=b(896),Yb=b(93),oc=b(174),zb=b(875),uc=b(846),P=b(932),lc=b(128),Ec=b(87),tc=b(186),cc=b(790),
Zb=b(88),Aa=b(108),Ia=b(28),qb=b(51);na.prototype.Lg=function(){this.La.Xb(Ia.a.uuf,Aa.a.frame,Object(ta.a)(this,this.KAe,"documentLabelPaneHandler"));this.La.Af(Ia.a.k8a,Aa.a.frame,Object(ta.a)(this,this.k8a,"queryPolicyLabel"),96);this.La.Xb(Ia.a.KQa,Aa.a.frame,Object(ta.a)(this,this.KQa,"toggleSensitivity"));this.La.Xb(Ia.a.jxa,Aa.a.frame,Object(ta.a)(this,this.jxa,"populateSensitivityFlyout"));this.La.Xb(Ia.a.setSensitivity,Aa.a.frame,Object(ta.a)(this,this.setSensitivity,"setSensitivity"));this.La.Af(Ia.a.l8a,
Aa.a.frame,Object(ta.a)(this,this.l8a,"querySensitivity"),96);this.La.Xb(Ia.a.s5,Aa.a.frame,Object(ta.a)(this,this.s5,"querySensitivityToggleButton"));this.La.Xb(Ia.a.r5,Aa.a.frame,Object(ta.a)(this,this.r5,"querySensitivitySubFlyout"));this.wjb(Ia.a.KQa)||this.La.l$a(Ia.a.KQa,4);this.wjb(Ia.a.jxa)||this.La.l$a(Ia.a.jxa,4);this.wjb(Ia.a.setSensitivity)||this.La.l$a(Ia.a.setSensitivity,4);this.wjb(Ia.a.s5)||this.La.l$a(Ia.a.s5,4);this.wjb(Ia.a.r5)||this.La.l$a(Ia.a.r5,4);this.Ce.updateCommandUI()};
na.prototype.PJb=function(){this.La.xC(Ia.a.uuf,Aa.a.frame,Object(ta.a)(this,this.KAe,"documentLabelPaneHandler"));this.La.xC(Ia.a.k8a,Aa.a.frame,Object(ta.a)(this,this.k8a,"queryPolicyLabel"));this.La.xC(Ia.a.KQa,Aa.a.frame,Object(ta.a)(this,this.KQa,"toggleSensitivity"));this.La.xC(Ia.a.jxa,Aa.a.frame,Object(ta.a)(this,this.jxa,"populateSensitivityFlyout"));this.La.xC(Ia.a.setSensitivity,Aa.a.frame,Object(ta.a)(this,this.setSensitivity,"setSensitivity"));this.La.xC(Ia.a.l8a,Aa.a.frame,Object(ta.a)(this,
this.l8a,"querySensitivity"));this.La.xC(Ia.a.s5,Aa.a.frame,Object(ta.a)(this,this.s5,"querySensitivityToggleButton"));this.La.xC(Ia.a.r5,Aa.a.frame,Object(ta.a)(this,this.r5,"querySensitivitySubFlyout"))};na.prototype.KQa=function(){return 32};na.prototype.cOe=function(Ob){var yc="mandatoryLabelling_"+Ob.Id;this.Z3d[yc]=Ob.Id;var id={};return id.type="AppToggleButtonProps",id.id=yc,id.label=Ob.DisplayName,id.hideLabel=!1,id.customTooltip=Ob.Tooltip,id};na.prototype.XCh=function(){var Ob=[],yc=this.L7,
id;for(id in yc){var Tc=yc[id],od=this.Wu[id];if(od&&od.Enabled)if(Tc.count){var mc={};mc=(mc.sections=[],mc.shouldAutoOpen=!1,mc);var Le={};Le=(Le.id="mandatoryLabelling_flyoutMenuSection_"+od.Id,Le.controls=[],Le);Tc=Ol(Tc);for(var we=Tc.next();!we.done;we=Tc.next())(we=this.Wu[we.value])&&we.Enabled&&Array.add(Le.controls,this.cOe(we));Array.add(mc.sections,Le);Le={};od=(Le.type="AppFlyoutAnchorProps",Le.id="mandatoryLabelling_"+od.Id,Le.label=od.DisplayName,Le.hideLabel=!1,Le.hideChevron=!1,Le.hideIcon=
!1,Le.menuDefinition=mc,Le);Array.add(Ob,od)}else Array.add(Ob,this.cOe(od))}return Ob};na.prototype.jxa=function(Ob,yc,id,Tc,od){if(1===id||!this.Wg.value.zfa())return 32;od.MenuItems=Object.assign(new zb.a,{Id:"SensitivityList",MenuSectionList:[],UpdateDynamically:!0});Array.add(od.MenuItems.MenuSectionList,this.Oc(!this.isReactRibbonEnabled()));this.Hg.CustomUrl&&Array.add(od.MenuItems.MenuSectionList,this.cVg(this.isReactRibbonEnabled()?this.Hg.CustomUrl:Na.a.If(this.Hg.CustomUrl)));this.isReactRibbonEnabled()||
(od.PopulationXML=Wa.s(od.MenuItems));return 32};na.prototype.l8a=function(Ob,yc,id,Tc,od){if(1===id||!od||!this.avb)return 32;this.Hg=this.Wg.value.an;if(this.Wg.value.zfa()&&(od[ma.visible]=!0,oc.a("MipLabelsAvailable"),this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelTUIEnabled",!1)&&this.Hg&&this.Hg.AreLabelsAvailable&&(Ob=Zb.a.instance.oc("Common.ISystemInitiatedFeedback")))){var mc=na.ma(this.Hg.AppliedPolicyId)?"LouderLabel_NoLabelAppliedOnLoadActivity":"LouderLabel_LabelExistsOnLoadActivity";
Ob.execute(function(Le){Le.logActivity(mc,null)})}return 32};na.prototype.s5=function(Ob,yc,id,Tc,od){if(1===id||!od)return 32;var mc,Le;od[ma.oZf]=!!(mc=od[ma.menuItemId])&&!!(Le=this.Ugb[mc])&&Le===this.Hg.AppliedPolicyId;return 32};na.prototype.r5=function(Ob,yc,id,Tc,od){if(1===id||!od)return 32;var mc,Le,we;Ob=!!(mc=od[ma.EH])&&!!(Le=this.Ugb[mc])&&!!(we=this.L7[Le])&&we.contains(this.Hg.AppliedPolicyId);od[ma.loh]=Ob;od[ma.oZf]=Ob;return 32};na.prototype.setSensitivity=function(Ob,yc,id,Tc,
od){return 1!==id&&od?this.B$a(this.Ugb[od[ma.EH]],od,2):32};na.prototype.ybc=function(){return this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.DefaultAndMandatoryLabelingDecouplingEnabled",!1)&&!!Ga.AFrameworkApplication.xa&&1===Ga.AFrameworkApplication.xa.mode};na.prototype.wPi=function(){this.GFc&&!this.ybc()&&(this.GFc=!1,this.Wg.value.vPi())};na.prototype.g_f=function(){this.Hg.DefaultLabelId&&this.Hg.MandatoryLabelingEnforced?this.CBc||this.ybc()?this.Hg.AppliedPolicyId?this.N3b(""):
(this.Wg.value.B5h(this.Wg.value.Axb)||this.ybc())&&this.D2c():this.kqc():this.Hg.DefaultLabelId?this.kqc():this.Hg.MandatoryLabelingEnforced&&(this.Hg.AppliedPolicyId?this.N3b(""):this.D2c())};na.prototype.m_f=function(){this.Hg.MandatoryLabelingEnforced?this.Hg&&this.Hg.AreLabelsAvailable?this.vb.sa("TestOverrideIsReactDialogEnabled")||this.Ce&&this.Ce.Xa&&this.Ce.Xa.qu?""===this.Hg.AppliedPolicyId?!this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.DefaultAndMandatoryLabelingDecouplingEnabled",
!1)&&this.Hg.DefaultLabelId&&(this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.DefaultLabelingExistingDocumentIsEnabled",!1)||this.sKa)?ea.ULS.sendTraceTag(572601948,306,50,"Mandatory labelling not invoked b/c default label policy present!"):this.D2c():this.N3b(""):ea.ULS.sendTraceTag(572641315,306,50,"Mandatory labelling not invoked b/c react dialogs disabled!"):ea.ULS.sendTraceTag(572601946,306,50,"Mandatory labelling not invoked b/c there are no sensitivity labels!"):ea.ULS.sendTraceTag(572601945,
306,50,"Mandatory labelling not invoked b/c user did not have policy!")};na.prototype.n6e=function(){return this.Hg.MandatoryLabelingEnforced?this.Hg&&this.Hg.AreLabelsAvailable?this.vb.sa("TestOverrideIsReactDialogEnabled")||this.Ce&&this.Ce.Xa&&this.Ce.Xa.qu?!0:(ea.ULS.sendTraceTag(539109065,306,50,"Mandatory labelling not invoked b/c react dialogs disabled!"),!1):(ea.ULS.sendTraceTag(539109064,306,50,"Mandatory labelling not invoked b/c there are no sensitivity labels!"),!1):(ea.ULS.sendTraceTag(539109063,
306,50,"Mandatory labelling not invoked b/c user did not have policy!"),!1)};na.prototype.D2c=function(){var Ob=this;this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.DefaultAndMandatoryLabelingDecouplingEnabled",!1)&&!this.n6e()||Ga.AFrameworkApplication.nU||this.Y3d||(this.Y3d=Ga.AFrameworkApplication.nU=!0,ea.ULS.sendTraceTag(562837517,306,50,"Mandatory labelling is invoked successfully."),this.Wg.value.nAf("",1),this.Wg.value.KOc(37,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,
CommonUIStrings.l_MandatoryLabellingDialogDescriptionText,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarButton,function(){Ob.agi()}))};na.prototype.N3b=function(Ob){this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.DefaultAndMandatoryLabelingDecouplingEnabled",!1)&&!this.n6e()||!Ga.AFrameworkApplication.nU||(Ga.AFrameworkApplication.nU=!1,ea.ULS.sendTraceTag(562837518,306,50,"Mandatory labelling is escaped successfully."),this.Wg.value.EBd(),this.Wg.value.nAf(Ob,2))};na.prototype.agi=
function(){xa.instance.pVg(this.XCh(),this.Hg.CustomUrl,Object(ta.a)(this,this.bgi,"mandatoryLabellingDialogCallback"))};na.prototype.bgi=function(Ob){this.N3b(this.Z3d[Ob])};na.prototype.fle=function(){return this.vb.sa("CoAuthForProtectedFilesEnabled")&&this.vb.sa("SupportsOfficeClientCoauthoring")&&this.vb.sa("SetPolicyLabelAwaitFileExistsOnHostIsEnabled")&&!!this.HZd&&this.sKa};na.prototype.B$a=function(Ob,yc,id){var Tc=this;this.Wg.value.kMi(id);var od=32,mc=!1,Le=!0,we=2===id||8===id||16===
id,za=Ob===this.Hg.AppliedPolicyId;if(this.Izc&&this.Izc(Ob,we))ea.ULS.sendTraceTag(42860829,306,15,"SetSensitivity : As app doesn't support changing the label, skipping SetSensitivity call. ApplyLabelFlag : {0}",id),this.Ce.updateCommandUI();else if(yc&&ma.NQc in yc&&this.Wg.value.O8i(yc[ma.NQc]),Ob)if(this.Wg.value.s8e()||this.fle()&&this.ZFc)ea.ULS.sendTraceTag(42796168,306,50,"Policy label cannot be set because a set policy label request is already in progress. ApplyLabelFlag: {0}",id),this.Ce.updateCommandUI(),
we&&this.VVb(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityQuickApplicationErrorMessage);else if(this.vb.sa("HasDocumentEditRights"))if(this.Wg.value.OHg(Ob))if(this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.LabelHasUDPEnabled",!1)&&this.Wu[Ob]&&this.Wu[Ob].HasUserDefinedPermissions)ea.ULS.sendTraceTag(540608323,306,50,"UDP label cannot be applied during UDP in WAC Phase 1. ApplyLabelFlag: {0}",id),1!==id&&4!==id&&this.fwg();else if(we&&this.Hg.MandatoryLabelingEnforced&&
za)ea.ULS.sendTraceTag(570972054,306,50,"Policy label cannot be removed due to mandatory labeling. ApplyLabelFlag: {0}",id),this.VVb(CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogTitle,CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogDescriptionText);else{if(we&&this.vb.sa("WacLabelingJustificationDialogIsEnabled")&&this.Hg.RequiredDowngradeJustification&&(za||this.Wu[Ob].RequiredDowngradeJustification)&&!this.IPb)return ea.ULS.sendTraceTag(570972055,306,50,"Downgrade justification is required. ApplyLabelFlag: {0}",
id),this.GKd(Ob),od;if(this.fle()&&!this.HZd())this.yzc<this.e$f?(ea.ULS.sendTraceTag(577356770,306,50,"File does not exist on host, retrying after delay. RetryCount: {0} ApplyLabelFlag: {1}",this.yzc,id),this.ZFc=!0,this.yzc++,qb.Task.delay(this.f$f).continueWith(function(){Tc.ZFc=!1;Tc.B$a(Ob,yc,id)})):(ea.ULS.sendTraceTag(577356771,306,15,"Policy label cannot be set because maximum retries were reached checking for file existence. ApplyLabelFlag: {0}",id),mc=1!==id,Le=!1,od=8);else{if(this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.WacBlockParentLabelSetLabel",
!1)&&this.q4h(Ob)&&(ea.ULS.sendTraceTag(553911752,306,15,"Policy label cannot be set because the selected label is a parent label. ApplyLabelFlag: {0}",id),1===id||8===id||4===id))return od;ea.ULS.sendTraceTag(570972056,306,50,"SetSensitivityByPolicyId is succeeded. ApplyLabelFlag: {0}",id);this.setPolicyLabel(za?"":Ob,this.IPb,id);return od}}else ea.ULS.sendTraceTag(42796169,306,50,"Policy label cannot be set because the user is in a coauth session. ApplyLabelFlag: {0}",id),this.Ce.updateCommandUI(),
we&&this.VVb(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityCoauthApplicationErrorMessage);else ea.ULS.sendTraceTag(558892739,306,50,"Policy label cannot be set because the user doesn't have edit rights. ApplyLabelFlag: {0}",id),this.Ce.updateCommandUI(),we&&this.VVb(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityNoEditRightsErrorMessage);else ea.ULS.sendTraceTag(42796167,306,15,"Policy label cannot be set because the selected policy ID is null. ApplyLabelFlag: {0}",
id),this.Ce.updateCommandUI(),mc=we,Le=!1,od=8;this.Wg.value.jzd(0,id,mc,Le);return od};na.prototype.vWa=function(Ob,yc,id,Tc){id=void 0===id?null:id;Tc=void 0===Tc?!1:Tc;Yb.Health.instance.recordKpiUsage("MipAutoClassificationSetLabel",0,"wordclpfc",null);this.vb.sa("SupportsOfficeClientCoauthoring")&&this.vb.sa("CoAuthForProtectedFilesIsEnabled")?(this.kgb=!1,(this.Hg=this.Wg.value.an)&&!this.Hg.AppliedPolicyId?this.kgb=!0:this.Hg&&this.Hg.PolicyLabelAssignmentMethod&&(this.kgb=tc.c(this.Hg.PolicyLabelAssignmentMethod)===
tc.c("standard"))):this.kgb=Tc;Ob=na.ma(Ob)?null:this.Wu[Ob];(yc=na.ma(yc)?null:this.Wu[yc])?this.vea=new Ya(yc,!0,id):(this.Wg.value.Gba(29),this.zda=null);Ob?this.wna=new Ya(Ob,!1):this.GSa=null;this.qyd(null,null);return 32};na.prototype.Txg=function(Ob){""!==this.Hg.AppliedPolicyId?this.Wg.value.jzd(4,16,!0):this.B$a(Ob,null,16)};na.prototype.yOf=function(){this.Wu={};if(this.Hg=this.Wg.value.an)for(var Ob=Ol(this.Hg.SensitivityLabels),yc=Ob.next();!yc.done;yc=Ob.next())yc=yc.value,this.Wu[yc.Id]=
yc};na.prototype.q4h=function(Ob){if(this.L7&&Ob in this.L7){Ob=Ol(this.L7[Ob]);for(var yc=Ob.next();!yc.done;yc=Ob.next())if((yc=this.Wu[yc.value])&&yc.Enabled)return!0}return!1};na.prototype.ePf=function(){this.L7={};if(this.Hg=this.Wg.value.an){for(var Ob=Ol(this.Hg.SensitivityLabels),yc=Ob.next();!yc.done;yc=Ob.next())yc=yc.value,yc.ParentId||(this.L7[yc.Id]=new mb.a);Ob=Ol(this.Hg.SensitivityLabels);for(yc=Ob.next();!yc.done;yc=Ob.next())yc=yc.value,yc.ParentId&&yc.ParentId in this.L7&&this.L7[yc.ParentId].add(yc.Id)}};
na.prototype.zzf=function(){if(this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)){this.Hg=this.Wg.value.an;var Ob=this.avb&&this.isReactRibbonEnabled()&&this.Wg.value.zfa();na.Wxa(Ob);appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!Ob))}else this.avb&&this.isReactRibbonEnabled()?(this.Hg=this.Wg.value.an,this.Wg.value.zfa()?(na.Wxa(!0),appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!1))):na.Wxa(!1)):
na.Wxa(!1)};na.prototype.SPi=function(Ob){this.Izc=Ob};na.prototype.DQi=function(Ob){this.WFc=Ob};na.prototype.kqc=function(){this.vb.sa("WacApplyDefaultPolicyLabelIsEnabled")&&(this.ybc()?this.GFc=!0:!this.CBc&&(this.CBc=!0,(this.Hg=this.Wg.value.an)&&this.Hg.DefaultLabelId&&!this.Hg.AppliedPolicyId&&(ea.ULS.sendTraceTag(593774211,306,50,"Default label configured, checking if this is a new file"),this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.DefaultLabelingExistingDocumentIsEnabled",
!1)||this.sKa))&&(ea.ULS.sendTraceTag(593774210,306,50,"Default labeling triggered. DefaultLabel: {0}",this.Hg.DefaultLabelId),this.B$a(this.Hg.DefaultLabelId,null,1)))};na.prototype.qyd=function(){var Ob=this;if(!this.Wg.value.s8e()){var yc=this.Wu[this.Wg.value.an.AppliedPolicyId];this.kgb&&this.wna&&this.GSa!==this.wna.id&&(!yc||yc.Order<this.wna.sensitivityLabel.Order)&&(yc=this.B$a(this.wna.id,{},4),32!==yc?ea.ULS.sendTraceTag(50868813,306,10,"ProcessAutoSensitivityLabel: SetSensitivityByPolicyId failed with response: "+
yc):(this.GSa=this.wna.id,this.zda&&(yc=this.Wu[this.zda])&&yc.Order<=this.wna.sensitivityLabel.Order&&(this.Wg.value.Gba(29),this.zda=null)));yc=this.Wu[this.Wg.value.an.AppliedPolicyId];if(this.vea&&this.zda!==this.vea.id&&(!yc||yc.Order<this.vea.sensitivityLabel.Order)){var id=this.vea.id;this.Wg.value.Gba(29);this.Wg.value.DUb(29,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelRecommendationMessage,this.S$c(this.vea.sensitivityLabel))+" "+this.vea.BOi,CommonUIStrings.l_PolicyLabelRecommendationButton,
function(){Ob.B$a(id,{},8)});this.zda=this.vea.id}this.vea=this.wna=null}};na.prototype.setPolicyLabel=function(Ob,yc,id){id=void 0===id?2:id;this.IPb=yc;this.Wg.value.setPolicyLabel(Ob);this.Ce.updateCommandUI();yc=new xb(id,this.S$c(this.Wu[Ob]));this.Wg.value.SHd(Ob,this.IPb,yc)};na.prototype.iQg=function(Ob,yc,id){1===Ob?this.setPolicyLabel(yc===this.Hg.AppliedPolicyId?"":yc,id):this.Ce.updateCommandUI()};na.prototype.GKd=function(Ob){(new ib(Ob,Object(ta.a)(this,this.iQg,"continueToSetPolicyLabel"))).GKd()};
na.prototype.VVb=function(Ob,yc){Ob=void 0===Ob?"":Ob;yc=void 0===yc?"":yc;var id=new lc.StandardDialog;id.lu=Ga.AFrameworkApplication.hvb;id.hc=0;id.yc(1,CommonUIStrings.l_DialogClose);id.WV(Ob,yc,null)};na.prototype.XBg=function(Ob){1===Ob&&this.Wg.value.oMi()};na.prototype.fwg=function(){var Ob=new lc.StandardDialog;Ob.lu=Ga.AFrameworkApplication.hvb;Ob.hc=1;Ob.yc(1,CommonUIStrings.l_OICDownLoadACopyDialogOpenButton);Ob.yc(0,CommonUIStrings.l_DialogClose);Ob.WV(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,
CommonUIStrings.l_SensitivityBlockUDPSetLabelMessage,Object(ta.a)(this,this.XBg,"blockUDPSetLabelHandler"))};na.prototype.isReactRibbonEnabled=function(){return!!this.Ce&&!!this.Ce.Xa&&this.Ce.Xa.mi};na.prototype.jwb=function(){return this.Ce&&this.Ce.Xa?this.Ce.Xa.jwb:!1};na.prototype.KAe=function(){return 32};na.prototype.k8a=function(Ob,yc,id,Tc,od){if(1===id)return 32;this.Hg=this.Wg.value.an;if(!this.Hg||!od)return 32;od[ma.value]="";od[ma.Qi]="";od[ma.alt]=null;od[ma.x0e]=null;od[ma.u2a]=null;
od[ma.visible]=!1;od[ma.iconColor]="";Ob=od[ma.icon]="";if(!this.Hg.AreLabelsAvailable){if(!this.oGc)return 32;od[ma.value]=od[ma.Qi]=this.oGc;this.MPb&&(this.jwb()?od[ma.customTooltip]=this.MPb:od[ma.alt]=this.MPb)}else if(this.Hg.AppliedPolicyId){yc=null;id=Ol(this.Hg.SensitivityLabels);for(Tc=id.next();!Tc.done;Tc=id.next())if(Tc=Tc.value,Tc.Id.toLowerCase()===this.Hg.AppliedPolicyId.toLowerCase()){yc=Tc;break}yc&&(od[ma.value]=od[ma.Qi]=this.S$c(yc),this.jwb()?od[ma.customTooltip]=yc.Tooltip:
od[ma.alt]=yc.Tooltip,this.s7d=Ga.AFrameworkApplication.protectedFile=yc.IsEndpointProtectionEnabled,Ob=this.aPe(yc))}od[ma.value]?this.G8i(Ob,this.s7d,od):this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)&&(od[ma.iconColor]=ma.tye,this.Hg.MandatoryLabelingEnforced?(od[ma.value]=od[ma.Qi]=ma.Bmj,od[ma.icon]=ma.DNi):(od[ma.value]=od[ma.Qi]=ma.Amj,od[ma.icon]=ma.INi),od[ma.visible]=!0);return 32};na.prototype.S$c=function(Ob){return Ob?this.Wu?Ob.ParentId&&this.Wu[Ob.ParentId]?
this.Wu[Ob.ParentId].DisplayName+"\\"+Ob.DisplayName:Ob.DisplayName:(ea.ULS.sendTraceTag(4282E4,306,15,"Policy ID to Sensitivity label dictionary has not been initialized."),Ob.DisplayName):""};na.prototype.G8i=function(Ob,yc,id){this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)&&(id[ma.iconColor]=this.lVe(Ob));id[ma.x0e]=Ga.AFrameworkApplication.WB;id[ma.u2a]=yc?Fa.getImageClass(ma.Vlj):Fa.getImageClass(ma.Ylj);this.jwb()&&(this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",
!1)?id[ma.icon]=this.kVe(Ob,yc):id[ma.icon]=yc?ma.Ulj:ma.Xlj);id[ma.visible]=!0};na.prototype.cVg=function(Ob){var yc=this.bT("LearnMoreSection",!0);Ob=Object.assign(new lb.a,{Id:"SensitivityLearnMore",ExternalId:"SensitivityLearnMore",MenuItemId:Ob,LabelText:CommonUIStrings.l_LearnMore,Command:"1959943459",Image16by16:Ga.AFrameworkApplication.WB,Image16by16Class:Fa.getImageClass(ma.Q$h),Visible:!0,Alt:CommonUIStrings.L_LearnMoreTooltip,KeyTip:"L"});Array.add(yc.ControlList,Ob);return yc};na.prototype.Pwe=
function(Ob,yc,id,Tc){id=void 0===id?"":id;Tc=void 0===Tc?!1:Tc;var od="Toggle_";Ga.AFrameworkApplication.ifc("4ie32269;hjfid788");od=this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpToggleButtonIdIsEnabled",!1)?od+Ob.Id:od+(id+"_"+Ob.Name);od="Sensitivity_"+od;var mc=Ob.DisplayName,Le=Ob.Tooltip,we=Ob.Id===this.Hg.AppliedPolicyId;id=Tc?Na.a.If(od):od;this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)?(we=this.aPe(Ob),yc=Object.assign(new P.a,{Id:id,
ExternalId:id,LabelText:Tc?Na.a.If(mc):mc,Command:"2935633379",MenuItemId:id,QueryCommand:"991261903",Visible:!0,Alt:Tc?Na.a.If(Le):Le,AriaLabel:Ec.a.HWb,IconColor:this.lVe(we),KeyTip:yc}),yc.ExternalImageId=this.kVe(we,Ob.IsEndpointProtectionEnabled)):(yc=Object.assign(new ha.a,{Id:id,ExternalId:id,LabelText:Tc?Na.a.If(mc):mc,Command:"2935633379",MenuItemId:id,QueryCommand:"991261903",CheckedImage:Ga.AFrameworkApplication.WB,Visible:!0,Alt:Tc?Na.a.If(Le):Le,IsChecked:we,AriaLabel:Ec.a.HWb,KeyTip:yc}),
this.isReactRibbonEnabled()?(yc.CheckedImageClass=Fa.getImageClass(ma.wzd),yc.ExternalImageId=ma.wzd):yc.CheckedImageClass=Fa.getImageClass(ma.Pmb));id=od;this.Ugb[id]=Ob.Id;this.V6d[Ob.Id]=id;return yc};na.prototype.bT=function(Ob,yc){yc=void 0===yc?!1:yc;return Object.assign(new uc.a,{Title:"",Id:Ob,DisplayMode:ma.menu,ShowMenuSectionSeparator:yc,ControlsId:"Ctrl_"+Ob,ControlList:[]})};na.prototype.eYg=function(Ob,yc,id){var Tc=this.bT(Ob+"Sub"),od=1;yc=Ol(yc);for(var mc=yc.next();!mc.done;mc=yc.next())(mc=
this.Wu[mc.value])&&mc.Enabled&&(Array.add(Tc.ControlList,this.Pwe(mc,od.toString(),Ob,id)),od++);return Tc};na.prototype.Oc=function(Ob){Ob=void 0===Ob?!1:Ob;var yc=this.bT("SensitivitySection"),id=1,Tc=this.L7,od;for(od in Tc){var mc=Tc[od],Le=this.Wu[od];if(Le&&Le.Enabled){if(mc.count){var we="Sensitivity_"+Le.Name,za=Ob?Na.a.If(we):we;za=Object.assign(new Ra.a,{Id:za,ExternalId:za,LabelText:Ob?Na.a.If(Le.DisplayName):Le.DisplayName,Command:"798637440",QueryCommand:"2875864574",Menu:Object.assign(new zb.a,
{Title:"",MenuSectionList:[],UpdateDynamically:!0}),ImageIsVisible:!1,Toggled:!1,ImageUsesSpaceWhileInvisible:!0,AriaLabel:Ec.a.HWb,KeyTip:id.toString()});this.isReactRibbonEnabled()?za.ExternalImageId=ma.wzd:(za.Image16by16=Ga.AFrameworkApplication.WB,za.Image16by16Class=Fa.getImageClass(ma.Pmb));Array.add(za.Menu.MenuSectionList,this.eYg(we,mc,Ob));Array.add(yc.ControlList,za);this.Ugb[za.Id]=Le.Id;this.V6d[Le.Id]=za.Id}else Array.add(yc.ControlList,this.Pwe(Le,id.toString(),void 0,Ob));id++}}return yc};
na.prototype.wjb=function(Ob){return!!this.La.Jha(Ob)&&!!this.La.Jha(Ob).flags&&!!this.La.Jha(Ob).flags.length};na.prototype.cBi=function(Ob,yc){yc.onSuccess&&this.Wu&&(Ob=this.Wu[this.Wg.value.an.AppliedPolicyId])&&(this.zda&&(yc=this.Wu[this.zda])&&yc.Order<=Ob.Order&&(this.Wg.value.Gba(29),this.zda=null),this.GSa&&this.GSa!==Ob.Id&&(this.Wg.value.Gba(28),this.GSa=null))};na.prototype.kVe=function(Ob,yc){Ob=na.ma(Ob);return yc?Ob?ma.GNi:ma.FNi:Ob?ma.HNi:ma.ENi};na.prototype.lVe=function(Ob){return na.ma(Ob)?
ma.tye:Ob};na.prototype.aPe=function(Ob){if(!na.ma(Ob.Color)||!Ob.ParentId)return Ob.Color;var yc=this.Wu[Ob.ParentId];return yc?yc.Color:Ob.Color};na.Wxa=function(Ob){Ob?(cc.a.Lrd("ribbon","sensitivity"),cc.a.Hrd("ribbon","sensitivity")):cc.a.Krd("ribbon","sensitivity")};na.ma=function(Ob){return Ob&&Ob.length?!1:!0};Ll.Object.defineProperties(na.prototype,{sKa:{configurable:!0,enumerable:!0,get:function(){return Ga.AFrameworkApplication.sKa||!!this.WFc&&this.WFc()}}});Object(ab.a)(na,"PolicyActor",
null,[278]);var wb=b(787),ic=b(786),Jb=b(94),Ua;(function(Ob){Ob[Ob.unknown=0]="unknown";Ob[Ob.boot=1]="boot";Ob[Ob.refresh=2]="refresh";Ob[Ob.selfSetPolicyLabel=3]="selfSetPolicyLabel"})(Ua||(Ua={}));Object(ab.b)("GetPolicyLabelsReason",Ua);var $a=Sys.EventArgs;Em(La,$a);Object(ab.a)(La,"AddAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);var ua=Sys.EventArgs;Em(ra,ua);Object(ab.a)(ra,"AddMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);var Ca;(function(Ob){Ob[Ob.none=0]="none";
Ob[Ob.reasonDefaultLabel=1]="reasonDefaultLabel";Ob[Ob.reasonManual=2]="reasonManual";Ob[Ob.reasonAutomatic=4]="reasonAutomatic";Ob[Ob.reasonRecommended=8]="reasonRecommended";Ob[Ob.reasonMandatory=16]="reasonMandatory"})(Ca||(Ca={}));Object(ab.b)("ApplyLabelFlags",Ca);var Sa=Sys.EventArgs;Em(ca,Sa);Object(ab.a)(ca,"AutoCLPSecurityNodesEventArgs",Sys.EventArgs,[]);var Qb=Sys.EventArgs;Em(Z,Qb);Object(ab.a)(Z,"GetPolicyLabelEventArgs",Sys.EventArgs,[]);var Hb=Sys.EventArgs;Em(U,Hb);Object(ab.a)(U,
"GetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);Object(ab.a)(da,"GetPolicyLabelsData",null,[]);var Db=Sys.EventArgs;Em(V,Db);Object(ab.a)(V,"LabelInfoUpdateEventArgs",Sys.EventArgs,[]);var jc=Sys.EventArgs;Em(Y,jc);Object(ab.a)(Y,"MandatoryLabellingAppHandlerEventArgs",Sys.EventArgs,[]);var sb=Sys.EventArgs;Em(N,sb);Object(ab.a)(N,"PolicyTipEventArgs",Sys.EventArgs,[]);var fb=Sys.EventArgs;Em(G,fb);Object(ab.a)(G,"RemoveAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);var Qa=Sys.EventArgs;
Em(W,Qa);Object(ab.a)(W,"RemoveMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);var cb=Sys.EventArgs;Em(fa,cb);Object(ab.a)(fa,"SetPolicyLabelEventArgs",Sys.EventArgs,[]);var Ab=Sys.EventArgs;Em(aa,Ab);Object(ab.a)(aa,"SetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);var gc=Sys.EventArgs;Em(L,gc);Object(ab.a)(L,"SetPolicyLabelTriggeredEventArgs",Sys.EventArgs,[]);var Lc=Sys.EventArgs;Em(Q,Lc);Object(ab.a)(Q,"UDPLabelingAppHandlerEventArgs",Sys.EventArgs,[]);var Nc=b(109),yd=b(98),Od=
b(41),sa=b(78),vb=b(48);Object(ab.a)(S,"ClientRequest",null,[]);var Lb=b(411),rc=b(371);H.z7i=function(Ob,yc){if(!Ob||!yc||Ob.count!==yc.count)return!1;Ob=Ol(Ob);for(var id=Ob.next();!id.done;id=Ob.next())if(!yc.contains(id.value))return!1;return!0};H.toArray=function(Ob){if(!Ob)return null;var yc=Array(Ob.count),id=0;Ob=Ol(Ob);for(var Tc=Ob.next();!Tc.done;Tc=Ob.next())yc[id]=Tc.value,id++;return yc};Object(ab.a)(H,"HashSetUtils",null,[]);var Oc=b(274),Bb=b(75),hc=b(177);A.prototype.dge=function(Ob){this.Ya.addHandler("PolicyTipEvent",
Ob)};A.prototype.DPc=function(Ob){this.Ya.addHandler("LabelInfoUpdateEvent",Ob)};A.prototype.vge=function(Ob){this.Ya.addHandler("SetPolicyLabelEventKey",Ob)};A.prototype.PVi=function(Ob){this.Ya.removeHandler("SetPolicyLabelEventKey",Ob)};A.prototype.ZPc=function(Ob){this.Ya.addHandler("SetPolicyLabelFailureEventKey",Ob)};A.prototype.OVi=function(Ob){this.Ya.removeHandler("SetPolicyLabelFailureEventKey",Ob)};A.prototype.wsg=function(Ob){this.Ya.addHandler("GetPolicyLabelEventKey",Ob)};A.prototype.vsg=
function(Ob){this.Ya.addHandler("GetPolicyLabelFailureEventKey",Ob)};A.prototype.usg=function(Ob){this.Ya.addHandler("GetAutoPolicyLabelEventKey",Ob);this.kgd&&(ea.ULS.sendTraceTag(51668058,306,15,"GetAutoPolicyLabelHandler was registered after the AutoPolicyLabelHandlerEvent was raised"),this.$yd(new Z(0)))};A.prototype.jUi=function(Ob){this.Ya.removeHandler("GetAutoPolicyLabelEventKey",Ob)};A.prototype.Rrg=function(Ob){this.Ya.addHandler("CreateAutoCLPSecurityNodesEventKey",Ob)};A.prototype.LTi=
function(Ob){this.Ya.removeHandler("CreateAutoCLPSecurityNodesEventKey",Ob)};A.prototype.Oug=function(Ob){this.Ya.addHandler("UpdateAutoCLPLabelPriorityNodeEventKey",Ob)};A.prototype.gWi=function(Ob){this.Ya.removeHandler("UpdateAutoCLPLabelPriorityNodeEventKey",Ob)};A.prototype.Pug=function(Ob){this.Ya.addHandler("UpdateAutoCLPSITNodesEventKey",Ob)};A.prototype.hWi=function(Ob){this.Ya.removeHandler("UpdateAutoCLPSITNodesEventKey",Ob)};A.prototype.Vee=function(Ob){this.Ya.addHandler("AddAutoPolicyBusinessBarEntryEventKey",
Ob)};A.prototype.dTi=function(Ob){this.Ya.removeHandler("AddAutoPolicyBusinessBarEntryEventKey",Ob)};A.prototype.ige=function(Ob){this.Ya.addHandler("RemoveAutoPolicyBusinessBarEntryEventKey",Ob)};A.prototype.yVi=function(Ob){this.Ya.removeHandler("RemoveAutoPolicyBusinessBarEntryEventKey",Ob)};A.prototype.Wee=function(Ob){this.Ya.addHandler("AddMandatoryLabellingBusinessBarEntryEventKey",Ob)};A.prototype.fTi=function(Ob){this.Ya.removeHandler("AddMandatoryLabellingBusinessBarEntryEventKey",Ob)};
A.prototype.jge=function(Ob){this.Ya.addHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",Ob)};A.prototype.zVi=function(Ob){this.Ya.removeHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",Ob)};A.prototype.etg=function(Ob){this.Ya.addHandler("MandatoryLabellingAppHandlerEventKey",Ob)};A.prototype.NUi=function(Ob){this.Ya.removeHandler("MandatoryLabellingAppHandlerEventKey",Ob)};A.prototype.Lug=function(Ob){this.Ya.addHandler("UDPLabelingAppHandlerEventKey",Ob)};A.prototype.eWi=function(Ob){this.Ya.removeHandler("UDPLabelingAppHandlerEventKey",
Ob)};A.prototype.dKg=function(){return Ga.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsClpBlockedByAppSpecificScenarioEnabled",!1)?this.c1d?this.c1d():!1:!1};A.prototype.OPi=function(Ob){this.szc=Ob};A.prototype.wv=function(){return(new Date).getTime()};A.prototype.b9c=function(){this.jh&&(this.cRb=this.jh.Dc("WebServiceCall","Call Get Policy Endpoint On Server"));var Ob=Oc.a.Gga(1,1);this.vb.sa("SendHostAttributionInfoForPolicyLabelEnabled")?(Ob=new S(this.$0a("datalosspolicy"),
1,null,null,!0,2,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Ob),this.Ng.send(Ob).IAd(Object(ta.a)(this,this.Klf,"onDataLossPolicySuccessCallback"),Object(ta.a)(this,this.Jlf,"onDataLossPolicyFailureCallback"))):this.Ng.Jl(this.$0a("datalosspolicy"),1,null,null,!0,2,Object(ta.a)(this,this.Klf,"onDataLossPolicySuccessCallback"),Object(ta.a)(this,this.Jlf,"onDataLossPolicyFailureCallback"),null);this.Afb++;ea.ULS.sendTraceTag(25565151,306,50,"Policy request is sent to server. The endpoint used is {0}. Policy call times: {1}.",
this.U6d,this.Afb)};A.prototype.vPi=function(){this.a9c(this.Q6,2,this.sna)};A.prototype.a9c=function(Ob,yc,id,Tc){yc=void 0===yc?0:yc;id=void 0===id?null:id;Tc=void 0===Tc?!1:Tc;Yb.Health.instance.recordKpiUsage("MipGetPolicyLabel",0,"officewebclp",this.m9c(void 0,yc));this.Dsb=this.wv();var od=this.lZc(yc);this.s7b(Ob,od,id,Tc,yc)};A.prototype.Klf=function(Ob){this.Gwf();var yc=this.APd(Ob);Ob=yc.data;yc.returnValue&&(ea.ULS.sendTraceTag(25565153,306,50,"Request to get DataLossPrevention policy succeeded."),
this.Afb=0,this.jh&&(this.dRb=this.jh.Dc("Task","Parse and Handle Get Policy Response")),this.eEi(Ob),this.dRb&&(this.dRb.stop(),this.dRb=null))};A.prototype.Jlf=function(Ob){this.Gwf();this.Afb<=this.dQb?this.b9c():(ea.ULS.sendTraceTag(25565154,306,15,"Request to get DataLossPrevention policy failed with error response: {0}.",Ob?Ob.data?Ob.data.jOa:null:null),this.Afb=0)};A.prototype.s8e=function(){return 0<this.tpa};A.prototype.setPolicyLabel=function(Ob){this.an.AppliedPolicyId=Ob};A.prototype.SHd=
function(Ob,yc,id){id=void 0===id?null:id;var Tc=this.HUg(id);this.z9i(Ob,yc,Tc,id)};A.prototype.qsf=function(Ob){this.YCa&&(this.YCa.stop(),this.YCa=null);var yc=this.vUe(Ob);var id=yc.OLf;yc=yc.lPf;var Tc=Ob.data.state,od=Tc?Tc.qO:2,mc=this.APd(Ob);Ob=mc.data;mc.returnValue?(ea.ULS.sendTraceTag(41799707,306,50,"Request to set label policy data succeeded. ApplyLabelFlag: {0}",od),this.tpa=0,this.wEi(Ob,id,yc,Tc)):this.DEd(od)};A.prototype.kMi=function(Ob){Yb.Health.instance.recordKpiUsage("MipSetPolicyLabel",
0,"officewebclp",this.m9c(Ob));this.FGb=this.wv();ea.ULS.sendTraceTag(575947405,306,50,"Raising set policy label triggered event.");this.Ya.raiseEvent("SetPolicyLabelTriggeredEventKey",new L(Ob))};A.prototype.Hli=function(){this.ibc&&this.supportsOfficeClientCoauthoring&&this.M5h&&this.TCa.eca(12,null,!0)};A.prototype.psf=function(Ob){this.YCa&&(this.YCa.stop(),this.YCa=null);var yc=this.vUe(Ob);var id=yc.OLf;yc=yc.lPf;this.tpa<=this.dQb?this.SHd(id,yc):(id=(id=Ob.data.state)?id.qO:2,ea.ULS.sendTraceTag(41799708,
306,15,"Request to set label policy failed with error response: {0}. ApplyLabelFlag: {1}",Ob?Ob.data?Ob.data.jOa:null:null,id),this.Axb="WACServerConnectionFailed",this.tpa=0,this.DEd(id))};A.prototype.B5h=function(Ob){if(Ob&&("LabelNotSupported"===Ob||"LabelErrorRetryLater"===Ob||"CoherencyFailure"===Ob||"LabelIdNotFound"===Ob||"LabelDisabled"===Ob))return ea.ULS.sendTraceTag(539103556,306,50,"LabelError is retriable: {0}",Ob),!0;ea.ULS.sendTraceTag(539103557,306,50,"LabelError is not retriable: {0}",
Ob);return!1};A.prototype.OHg=function(Ob){if(!Ob)return!1;for(var yc=null,id=null,Tc=Ol(this.an.SensitivityLabels),od=Tc.next();!od.done;od=Tc.next())od=od.value,od.Id===Ob&&(yc=od),od.Id===this.Q6&&(id=od);if(!yc)return!1;if(this.ibc&&this.supportsOfficeClientCoauthoring){if(this.szc&&this.szc()||this.phd)return!0}else if(Ga.AFrameworkApplication.Vx&&Ga.AFrameworkApplication.Vx.yrb||this.sna&&this.sna())return!0;return yc.IsEndpointProtectionEnabled===(!!id&&id.IsEndpointProtectionEnabled)};A.prototype.DUb=
function(Ob,yc,id,Tc,od){28===Ob?this.Vzf(new La(Ob,yc,id,Tc,od,!1)):this.Vzf(new La(Ob,yc,id,Tc,od,!0))};A.prototype.Gba=function(Ob){28===Ob?this.yAf(new G(Ob,!1)):this.yAf(new G(Ob,!0))};A.prototype.xLi=function(Ob,yc,id){ea.ULS.sendTraceTag(545280777,306,50,"Raising a CreateAutoCLPSecurityNodes event.");this.Ya.raiseEvent("CreateAutoCLPSecurityNodesEventKey",new ca(Ob,yc,id))};A.prototype.pMi=function(Ob){ea.ULS.sendTraceTag(545280778,306,50,"Raising a UpdateAutoCLPLabelPriorityNode event.");
this.Ya.raiseEvent("UpdateAutoCLPLabelPriorityNodeEventKey",new ca(null,null,Ob))};A.prototype.qMi=function(Ob,yc){ea.ULS.sendTraceTag(545280779,306,50,"Raising a UpdateAutoCLPSITNodes event.");this.Ya.raiseEvent("UpdateAutoCLPSITNodesEventKey",new ca(Ob,yc,null))};A.prototype.nAf=function(Ob,yc){ea.ULS.sendTraceTag(572650527,306,50,"Raising a mandatory labelling"+(1===yc?"Reading":"Edit")+" switch event.");this.Ya.raiseEvent("MandatoryLabellingAppHandlerEventKey",new Y(Ob,yc))};A.prototype.KOc=function(Ob,
yc,id,Tc,od){37===Ob&&this.nLi(new ra(37,yc,id,Tc,od))};A.prototype.EBd=function(){this.eMi(new W)};A.prototype.oMi=function(){ea.ULS.sendTraceTag(540608322,306,50,"Raising a UDP labeling event.");this.Ya.raiseEvent("UDPLabelingAppHandlerEventKey",new Q(!0))};A.prototype.zfa=function(){var Ob=!!this.an&&this.an.AreLabelsAvailable&&!!this.an.SensitivityLabels&&0<this.an.SensitivityLabels.length&&rc.a.any(this.an.SensitivityLabels,function(yc){return!!yc&&yc.Enabled});Ob||na.Wxa(!1);return Ob};A.prototype.Dnf=
function(Ob){this.HBa&&(this.HBa.stop(),this.HBa=null);var yc=this.APd(Ob);var id=yc.data;yc.returnValue?(ea.ULS.sendTraceTag(34996493,306,50,"Request to get label policy data succeeded."),this.yfb=0,id=this.nEi(id),Ob=this.vTe(Ob.data),Yb.Health.instance.recordKpiSuccess("MipGetPolicyLabel",this.A6b(void 0,Ob,this.Dsb)),this.Dsb=null,Ob=new Z(Ob),this.HLi(Ob),this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?id&&this.xcj()?this.kgd?this.Uvj():(this.$_b(),this.$yd(Ob),
this.NEc=!0):this.Glc():!this.kgd&&id&&this.vb.sa("WacApplyManualPolicyLabelIsEnabled")&&this.Cje()?(this.$yd(Ob),this.NEc=!0):this.Glc()):this.Glc()};A.prototype.xcj=function(){if(!this.vb.sa("WacApplyManualPolicyLabelIsEnabled"))return ea.ULS.sendTraceTag(539877667,306,50,"ShouldAutoClassificationRun returned false - Manual Labeling is not enabled"),!1;if(!this.Cje())return!1;if(""===this.Q6)return ea.ULS.sendTraceTag(539877696,306,50,"ShouldAutoClassificationRun returned true - document is not labeled"),
!0;if(this.CAa===this.bEc)return ea.ULS.sendTraceTag(539877697,306,50,"ShouldAutoClassificationRun returned false - Applied label already has the highest priority"),!1;ea.ULS.sendTraceTag(539877698,306,50,"ShouldAutoClassificationRun returned true - document is labeled but not with the highest priority label");return!0};A.prototype.$_b=function(){this.H1f();ea.ULS.sendTraceTag(545104324,306,50,"Creating AutoCLP Security nodes. HasSITs: {0}, LabelPriority: {1}",0<this.WCa.count,this.CAa);var Ob=H.toArray(this.WCa);
this.xLi(Ob,Ob,this.CAa)};A.prototype.Uvj=function(){var Ob=this.WCa;this.H1f();H.z7i(Ob,this.WCa)||(ea.ULS.sendTraceTag(545104325,306,50,"Updating AutoCLP SIT nodes. HasSITs: {0}",0<this.WCa.count),Ob=H.toArray(this.WCa),this.qMi(Ob,Ob));this.E1d&&(ea.ULS.sendTraceTag(545104326,306,50,"Updating AutoCLP Label Priority node. LabelPriority: {0}",this.CAa),this.pMi(this.CAa))};A.prototype.H1f=function(){for(var Ob=new wb.a(ic.a.rl()),yc=Ol(this.an.SensitivityLabels),id=yc.next();!id.done;id=yc.next())if((id=
id.value)&&id.AutoLabelingSensitiveTypeIds&&0<id.AutoLabelingSensitiveTypeIds.length){id=Ol(id.AutoLabelingSensitiveTypeIds);for(var Tc=id.next();!Tc.done;Tc=id.next())(Tc=Tc.value)&&Ob.add(Tc)}this.WCa=Ob};A.prototype.Cnf=function(Ob){var yc=this.vTe(Ob.data);Yb.Health.instance.recordKpiFailure("MipGetPolicyLabel","GetPolicyLabelsFailure",!1,!1,this.A6b(void 0,yc,this.Dsb));this.Dsb=null;this.HBa&&(this.HBa.stop(),this.HBa=null);if(this.yfb<=this.dQb){if(this.vb.sa("SendHostAttributionInfoForPolicyLabelEnabled")){var id=
Ob.data.request.get_headers();if("HostAttributionInfo.ScenarioParamName"in id&&id[Oc.a.wFd]&&"HostAttributionInfo.ScenarioTypeParamName"in id&&id[Oc.a.xFd]){Ob.data.request.get_headers();Ob.data.request.get_headers();Ob=this.lZc(yc);this.s7b(this.Q6,Ob,this.sna,void 0,yc);return}}this.a9c(this.Q6,yc,this.sna)}else ea.ULS.sendTraceTag(34996494,306,15,"Request to get label policy failed with error response: {0}.",Ob?Ob.data?Ob.data.jOa:null:null),this.Glc(),this.yfb=0};A.prototype.vTe=function(Ob){return Ob.state?
Ob.state:0};A.prototype.$0a=function(Ob,yc){yc=void 0===yc?!1:yc;var id=String.format("{0}{1}?action={2}&{3}",this.vb.Ta("PolicyHandlerWebServiceBase")||Ga.AFrameworkApplication.xa.Xa.vZ,this.U6d,Ob,Ga.AFrameworkApplication.Xi);"setpolicylabel"===Ob&&Ga.AFrameworkApplication.Vx&&Ga.AFrameworkApplication.Vx.O4e&&(id=sa.a.$k(id,"sl","1"));yc&&(id=sa.a.$k(id,"cbd","1"));return id};A.prototype.vUe=function(Ob){var yc;var id=yc=null;Ob&&Ob.data&&Ob.data.request&&Ob.data.request.get_headers()&&(id=Ob.data.request.get_headers()[Lb.a.PLf],
yc=Ob.data.request.get_headers()[Lb.a.mPf]);return{OLf:id,lPf:yc}};A.prototype.APd=function(Ob){Ob=Ob?Ob.data?Ob.data.ae:null:null;return Ob&&Ob.length&&!this.j6h(Ob)?{returnValue:!0,data:Ob}:(ea.ULS.sendTraceTag(25565152,306,10,"No response data from policy endpoint."),{returnValue:!1,data:Ob})};A.prototype.eEi=function(Ob){try{var yc=Od.b(Ob)}catch(id){ea.ULS.sendTraceTag(37880331,306,10,"Error when deserializing DataLossPrevention response.");return}if(yc)if(yc.IsPolicyTipAvailable)switch(yc.IsPolicyTipAvailable.toLowerCase()){case "false":ea.ULS.sendTraceTag(26007261,
306,50,"policyData.IsPolicyTipAvailable is false so DLP policy tip is not present.");break;case "true":ea.ULS.sendTraceTag(25565186,306,50,"DLP Policy is enabled on this document.");this.yBc=yc.NavigateUrl;this.xhj(yc.GeneralText,Object(ta.a)(this,this.Kqi,"onDataLossPolicyOverrideButtonClick"));break;default:ea.ULS.sendTraceTag(26007262,306,10,"policyData.IsPolicyTipAvailable is expected to be 'true' or 'false' but it is {0}",yc.IsPolicyTipAvailable)}else ea.ULS.sendTraceTag(26007260,306,10,"policyData.IsPolicyTipAvailable is null or empty whereas it should be 'true' or 'false'.");
else ea.ULS.sendTraceTag(25565185,306,10,"policyData is null after deserializing DataLossPrevention response.")};A.prototype.wEi=function(Ob,yc,id,Tc){var od=this,mc=Tc?Tc.qO:2,Le=0,we="",za;if(function(){var bb=Od.d(Ob);za=bb.eu;return bb}().returnValue)if(za){we="Success";var Nb=this.lZc(3);if(za.IsSuccessful){Yb.Health.instance.recordKpiSuccess("MipSetPolicyLabel",this.A6b(mc,void 0,this.FGb));this.Axb=this.FGb=null;ea.ULS.sendTraceTag(51233632,306,50,"setPolicyLabel was successful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}",
mc);2===mc&&this.Gba(29);this.x$i(yc,mc);this.Hli();this.Gba(28);Tc&&4===mc&&this.DUb(28,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelAutomaticallyAppliedMessage,Tc.displayName),CommonUIStrings.l_DialogOk,function(){});oc.a("MipAppliedLabels",void 0,void 0,[Object.assign(new Bb.a,{name:"SetPolicyLabelApplyFlag",string:Ca[mc]})]);this.s7b(yc,Nb,this.sna,void 0,3);return}ea.ULS.sendTraceTag(51233631,306,10,"setPolicyLabel was unsuccessful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}, FailureReason: {1}",
mc,za.FailureReason);this.Axb=za.FailureReason;"FileTooLarge"===za.FailureReason?Le=1:"LabelNotSupported"===za.FailureReason?Le=2:"LabelDisabled"===za.FailureReason?Le=3:"MinorVersionLimitExceeded"===za.FailureReason&&(Le=5);this.n6h&&0<=za.FailureReason.indexOf("InvalidOperationOnZeroByteFile")&&(Tc=new Nc.a(2,1,this.A9i,function(){ea.ULS.sendTraceTag(575428443,306,15,"Retring SetPolicyLabelRequestAsync as previous called failed due to zero byte. Attempt number : {0}",od.tpa);od.tpa<=od.dQb&&od.SHd(yc,
id)}),this.fe.kh(Tc));this.ibc&&this.supportsOfficeClientCoauthoring&&this.s7b(this.an.AppliedPolicyId,Nb,this.sna,!0,3)}else we="setPolicyLabelData null.",ea.ULS.sendTraceTag(42467541,306,10,"setPolicyLabelData is null after deserializing set policy label data response. ApplyLabelFlag: {0}",mc);else we="TryDeserialize failed.",ea.ULS.sendTraceTag(41799709,306,10,"Error when deserializing set policy label data response. ApplyLabelFlag: {0}",mc);this.DEd(mc,Le);mc=this.A6b(mc,void 0,this.FGb);this.FGb=
null;mc.extendedProperties.set("SetPolicyLabelDataFailureReason",this.Axb);mc.extendedProperties.set("SetPolicyLabelDataParseStatus",we.toString());Yb.Health.instance.recordKpiFailure("MipSetPolicyLabel","SetPolicyLabelFailure",!1,!1,mc)};A.prototype.DEd=function(Ob,yc){yc=void 0===yc?0:yc;this.setPolicyLabel(this.Q6);this.lAf(new V);this.jzd(yc,Ob,2===Ob||8===Ob||16===Ob,!1)};A.prototype.x$i=function(Ob,yc){this.setPolicyLabel(this.Q6=Ob);if(""===Ob)Ga.AFrameworkApplication.protectedFile=!1,Ga.AFrameworkApplication.enableMacrosForProtectedFile=
!1;else for(var id=Ol(this.an.SensitivityLabels),Tc=id.next();!Tc.done;Tc=id.next())if(Tc=Tc.value,Tc.Id===Ob){Ga.AFrameworkApplication.protectedFile=Tc.IsEndpointProtectionEnabled;break}this.jMi(new fa(Ob,yc))};A.prototype.Ixj=function(){for(var Ob=Ol(this.an.SensitivityLabels),yc=Ob.next();!yc.done;yc=Ob.next())(yc=yc.value)&&yc.Enabled&&(yc.Id===this.Q6&&(this.E1d=this.CAa!==yc.Order,this.CAa=yc.Order),yc.Order>this.bEc&&(this.bEc=yc.Order))};A.prototype.nEi=function(Ob){var yc=Od.d(Ob);Ob=yc.eu;
if(!yc.returnValue)return ea.ULS.sendTraceTag(34996495,306,10,"Error when deserializing label policy data response."),!1;if(!Ob)return ea.ULS.sendTraceTag(42467542,306,10,"policyData is null after deserializing label policy data response."),!1;if(!Ob.AreLabelsAvailable)return!1;this.an=Ob;this.Q6=Ob.AppliedPolicyId;this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)&&this.Ixj();this.zfa()&&ea.ULS.sendTraceTag(51197846,306,50,"Labels are available for display after GetPolicyLabels call.");
this.lAf(new V(!0));return!0};A.prototype.Cje=function(){if(!this.zfa())return ea.ULS.sendTraceTag(539877699,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels to display"),!1;for(var Ob=Ol(this.an.SensitivityLabels),yc=Ob.next();!yc.done;yc=Ob.next())if((yc=yc.value)&&yc.AutoLabelingSensitiveTypeIds&&0<yc.AutoLabelingSensitiveTypeIds.length)return!0;ea.ULS.sendTraceTag(539877700,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels with AutoClp SIT");return!1};
A.prototype.lAf=function(Ob){ea.ULS.sendTraceTag(35393610,306,50,"Raising label info update event.");this.Ya.raiseEvent("LabelInfoUpdateEvent",Ob)};A.prototype.HLi=function(Ob){ea.ULS.sendTraceTag(50676305,306,50,"Raising get policy label event.");this.Ya.raiseEvent("GetPolicyLabelEventKey",Ob)};A.prototype.Glc=function(){na.Wxa(!1);this.Ya.raiseEvent("GetPolicyLabelFailureEventKey",new U)};A.prototype.$yd=function(Ob){var yc=this;this.NN&&this.NN.execute(function(id){id=[id.isFeatureEnabled("MsoClpSpTwo",
!0),id.isFeatureEnabled("MsoDrmPremiumSpTwo",!0)];Promise.all(id).then(function(Tc){rc.a.any(Tc,function(od){return od})&&(ea.ULS.sendTraceTag(50944077,306,50,"Raising get auto policy label event."),yc.Ya.raiseEvent("GetAutoPolicyLabelEventKey",Ob),oc.a("MipAutoClassificationEnabled"));return null})})};A.prototype.m9c=function(Ob,yc){Ob=void 0===Ob?null:Ob;yc=void 0===yc?null:yc;var id=new Map;id.set("ClpCoauth",this.supportsOfficeClientCoauthoring.toString());null!=Ob&&id.set("ApplyLabelFlags",Ca[Ob]);
null!=yc&&id.set("GetPolicyLabelsReason",Ua[yc]);return id};A.prototype.A6b=function(Ob,yc,id){Ob=void 0===Ob?null:Ob;yc=void 0===yc?null:yc;id=void 0===id?null:id;var Tc=new hc.a;Tc.extendedProperties=this.m9c(Ob,yc);null!=id&&(Tc.durationMs=this.wv()-id);return Tc};A.prototype.jMi=function(Ob){ea.ULS.sendTraceTag(41799710,306,50,"Raising set policy label event.");this.Ya.raiseEvent("SetPolicyLabelEventKey",Ob)};A.prototype.Vzf=function(Ob){ea.ULS.sendTraceTag(51128227,306,50,"Raising an add auto policy business bar entry event.");
Ob&&Ob.lwb&&oc.a("MipRecommendations");this.Ya.raiseEvent("AddAutoPolicyBusinessBarEntryEventKey",Ob)};A.prototype.yAf=function(Ob){ea.ULS.sendTraceTag(51128256,306,50,"Raising an remove auto policy business bar entry event.");this.Ya.raiseEvent("RemoveAutoPolicyBusinessBarEntryEventKey",Ob)};A.prototype.nLi=function(Ob){ea.ULS.sendTraceTag(573842331,306,50,"Raising an add mandatory labelling business bar entry event.");this.Ya.raiseEvent("AddMandatoryLabellingBusinessBarEntryEventKey",Ob)};A.prototype.eMi=
function(Ob){ea.ULS.sendTraceTag(573842332,306,50,"Raising a remove mandatory labelling business bar entry event.");this.Ya.raiseEvent("RemoveMandatoryLabellingBusinessBarEntryEventKey",Ob)};A.prototype.xhj=function(Ob,yc){yc=void 0===yc?null:yc;ea.ULS.sendTraceTag(34996496,306,50,"Showing policy tip to user.");this.Ya.raiseEvent("PolicyTipEvent",new N(CommonUIStrings.l_PolicyBusinessBarTitle,Ob,CommonUIStrings.l_PolicyOverrideButton,yc))};A.prototype.jzd=function(Ob,yc,id,Tc){var od=this;ea.ULS.sendTraceTag(42074656,
306,void 0===Tc||Tc?50:15,"Raising set policy label failure event. ApplyLabelFlags: {0}",yc);if(this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CommonBusinessBarEntryForSensitivityLabelError",!1)){Tc=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarTitle;var mc=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarMessage,Le=null,we=null;switch(Ob){case 1:Tc=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarTitle;mc=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarMessage;
break;case 2:Tc=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarTitle;mc=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarMessage;break;case 3:Tc=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarTitle;mc=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarMessage;break;case 4:Tc=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorTitle;mc=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorMessage;
break;case 5:Tc=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarTitle,mc=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarMessage,Le=CommonUIStrings.l_LearnMore,we=function(){od.nPf()}}Ob=new aa(Ob,yc,id,Tc,mc,Le,we)}else Ob=5===Ob?new aa(Ob,yc,id,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarTitle,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarMessage,CommonUIStrings.l_LearnMore,
function(){od.nPf()}):new aa(Ob,yc,id);this.Ya.raiseEvent("SetPolicyLabelFailureEventKey",Ob)};A.prototype.O8i=function(Ob){this.bHc=Ob};A.prototype.Kqi=function(){this.yBc?(ea.ULS.sendTraceTag(25565187,306,50,"DLP override button was clicked."),vb.a.lY(this.yBc)):ea.ULS.sendTraceTag(25565188,306,10,"Null NavigateUrl got in policy response. Could not navigate to SPO.")};A.prototype.j6h=function(Ob){if(!Ob.startsWith("<")||-1===Ob.indexOf("Error")&&-1===Ob.indexOf("Unavailable"))return!1;ea.ULS.sendTraceTag(25565189,
306,10,"The response from server is not a valid JSON response and it matches the error page keyword. This might be the error response from a non-existing endpoint.");return!0};A.prototype.Gwf=function(){this.cRb&&(this.cRb.stop(),this.cRb=null)};A.prototype.$sh=function(Ob){if(!Ob)return"manual";switch(Ob.qO){case 0:return"manual";case 4:return"auto";case 1:return"default";case 16:return"mandatory";case 2:return"manual";case 8:return"recommended";default:return"manual"}};A.prototype.iuh=function(Ob){if(!Ob)return"privileged";
Ob=Ob.qO;var yc="privileged";if(4===Ob||1===Ob)yc="standard";return yc};A.prototype.s7b=function(Ob,yc,id,Tc,od){id=void 0===id?null:id;Tc=void 0===Tc?!1:Tc;od=void 0===od?0:od;this.vb.sa("WacLabelingGetPolicyLabelsIsEnabled")&&(this.Q6=Ob,this.sna=id,this.jh&&(this.HBa=this.jh.Dc("WebServiceCall","Call Get Policy Endpoint On Server")),id={},id[Lb.a.Hxg]=Ob,this.vb.sa("SendHostAttributionInfoForPolicyLabelEnabled")?(Ob=new S(this.$0a("getpolicylabels",Tc),1,null,id,!0,2,od,void 0,void 0,void 0,void 0,
void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,yc),this.Ng.send(Ob).IAd(Object(ta.a)(this,this.Dnf,"onGetPolicyLabelsSuccessCallback"),Object(ta.a)(this,this.Cnf,"onGetPolicyLabelsFailureCallback"))):this.Ng.Jl(this.$0a("getpolicylabels",Tc),1,null,id,!0,2,Object(ta.a)(this,this.Dnf,"onGetPolicyLabelsSuccessCallback"),Object(ta.a)(this,this.Cnf,"onGetPolicyLabelsFailureCallback"),od,void 0,void 0,void 0,void 0,"22"),this.yfb++,ea.ULS.sendTraceTag(34996492,306,50,"Policy label request sent to server. Policy call times: {0}",
this.yfb))};A.prototype.z9i=function(Ob,yc,id,Tc){Tc=void 0===Tc?null:Tc;if(this.avb){this.jh&&(this.YCa=this.jh.Dc("WebServiceCall","Call Set Policy Endpoint On Server"));var od={};od[Lb.a.PLf]=Ob;yc&&(od[Lb.a.mPf]=encodeURIComponent(yc));this.bHc&&(od[Lb.a.Zwg]=this.bHc);Tc?(od[Lb.a.jPf]=this.$sh(Tc),od[Lb.a.kPf]=this.iuh(Tc)):(od[Lb.a.jPf]="manual",od[Lb.a.kPf]="privileged");this.supportsOfficeClientCoauthoring&&this.an&&(od[Lb.a.eGi]=this.an.PolicyLabelVersionToken);this.vb.sa("SendHostAttributionInfoForPolicyLabelEnabled")?
(Ob=new S(this.$0a("setpolicylabel",!0),1,null,od,!0,2,Tc,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,id),this.Ng.send(Ob).IAd(Object(ta.a)(this,this.qsf,"onSetPolicyLabelSuccessCallback"),Object(ta.a)(this,this.psf,"onSetPolicyLabelFailureCallback"))):this.Ng.Jl(this.$0a("setpolicylabel",!0),1,null,od,!0,2,Object(ta.a)(this,this.qsf,"onSetPolicyLabelSuccessCallback"),Object(ta.a)(this,this.psf,"onSetPolicyLabelFailureCallback"),Tc,void 0,void 0,void 0,void 0,
"32");this.tpa++;ea.ULS.sendTraceTag(41799706,306,50,"Set policy label request sent to server. Policy call times: {0}",this.tpa)}else ea.ULS.sendTraceTag(570972052,306,50,"SetPolicyLabelRequestInternalAsync was exited - ApplyManualPolicyLabel was not enabled.")};A.prototype.nPf=function(){var Ob=new lc.StandardDialog,yc=this.vb.Ta("BreadcrumbFolderUrl");yc?(Ob.hc=11,Ob.yc(1,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoAction),Ob.yc(2,CommonUIStrings.l_DialogOk)):(Ob.hc=
0,Ob.yc(1,CommonUIStrings.l_DialogOk));Ob.Vde(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoHelpText,"0f6cd105-974f-44a4-aadb-43ac5bdfd247");Ob.qSi();Ob.WV(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoTitle,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoMessage,function(id){1===id&&yc&&vb.a.lf(yc,"_blank",void 0,"SetPolicyLabelFailureBusinessBarActionCallback.BreadcrumbFolderUrl")})};A.prototype.lZc=function(Ob){switch(Ob){case 1:return Oc.a.Gga(1,
1);case 2:return Oc.a.Gga(7,1);case 3:return Oc.a.Gga(8,1);default:return Oc.a.Gga(7,0)}};A.prototype.HUg=function(Ob){Ob=void 0===Ob?null:Ob;if(!Ob)return Oc.a.Gga(8,0);switch(Ob.qO){case 1:case 16:return Oc.a.Gga(1,1);case 4:case 2:case 8:return Oc.a.Gga(8,1);default:return Oc.a.Gga(8,0)}};Ll.Object.defineProperties(A.prototype,{kgd:{configurable:!0,enumerable:!0,get:function(){return this.NEc}},phd:{configurable:!0,enumerable:!0,get:function(){if(!this.WYd)return!1;for(var Ob=Ol(this.WYd.qFj()),
yc=Ob.next();!yc.done;yc=Ob.next())if(yc=yc.value,!yc.Capabilities||!yc.Capabilities.SupportsClientIsMipTrusted)return!1;return!0}},M5h:{configurable:!0,enumerable:!0,get:function(){return!!this.TCa}}});Object(ab.a)(A,"PolicyManager",null,[230]);var Pc=b(143),rd=b(276);E.prototype.init=function(){var Ob=this;Ga.AFrameworkApplication.ha.sa("ShouldInitCommonPolicyPackage")?(Ga.AFrameworkApplication.ha.sa("IsDataLossPreventionEnabledForUser")&&Ga.AFrameworkApplication.xa&&(this.Wg=this.Za.resolve("Common.App.Policy.Contracts.IPolicyManager"),
this.Wg.dge(Object(ta.a)(this,this.QKd,"showPolicyBusinessBar")),ea.ULS.sendTraceTag(36537375,306,50,"PolicyManager is created successfully."),Pc.a.get_instance().Om(6,function(){Ob.Wg.b9c()})),Ga.AFrameworkApplication.ha.sa("WacLabelingPoliciesIsEnabled")&&Ga.AFrameworkApplication.ha.sa("SupportsPolicies")?Pc.a.get_instance().Om(6,Object(ta.a)(this,this.coi,"onAfterRibbonBehaviorAttached")):na.Wxa(!1)):na.Wxa(!1)};E.prototype.dispose=function(){};E.prototype.Qh=function(Ob){Ob.register(230,"Common.App.Policy.Contracts.IPolicyManager").wc().Fc(function(){return new A(Ga.AFrameworkApplication.ha,
Ga.AFrameworkApplication.Cd,Ga.AFrameworkApplication.xa.MC,Ga.AFrameworkApplication.ha.xd("MaxGetPolicyRetries",1),Ob.oc("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),Ga.AFrameworkApplication.xa.Xa.Tk)});Ob.register(na,"Common.App.Policy.PolicyActor").as("Common.App.Policy.Contracts.IPolicyActor").wc().Fc(function(){return new na(Ga.AFrameworkApplication.Hb,Ga.AFrameworkApplication.xa,Ga.AFrameworkApplication.ha,Ob.jEd("Common.App.Policy.Contracts.IPolicyManager"))});this.Za=Ob};
E.prototype.coi=function(){this.Yoa=this.Za.resolve("Common.App.Policy.PolicyActor");this.Yoa.Lg();this.j0=this.Za.Mh("CommonUI.BusinessBar");this.Wg||(this.Wg=this.Za.resolve("Common.App.Policy.Contracts.IPolicyManager"));this.Wg.DPc(Object(ta.a)(this,this.OQd,"updateLabelInfo"));Ga.AFrameworkApplication.ha.sa("WacApplyManualPolicyLabelIsEnabled")&&(this.Wg.ZPc(Object(ta.a)(this,this.fPh,"handleSetPolicyLabelFailure")),this.Wg.Vee(Object(ta.a)(this,this.DUb,"addAutoPolicyBusinessBarEntry")),this.Wg.ige(Object(ta.a)(this,
this.Gba,"removeAutoPolicyBusinessBarEntry")),this.Wg.Wee(Object(ta.a)(this,this.KOc,"addMandatoryLabellingBusinessBarEntry")),this.Wg.jge(Object(ta.a)(this,this.EBd,"removeMandatoryLabellingBusinessBarEntry")))};E.prototype.OQd=function(Ob,yc){this.Yoa.ePf();this.Yoa.yOf();this.Yoa.zzf();Ob=this.Wg.dKg();Ga.AFrameworkApplication.ha.sa("HasDocumentEditRights")&&!Ob?Ga.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.DefaultAndMandatoryLabelingDecouplingEnabled",!1)?this.Yoa.g_f():
(this.Yoa.kqc(),yc.onSuccess&&this.Yoa.m_f()):ea.ULS.sendTraceTag(558682911,306,50,"Default/Mandatory Labeling has been skipped because HasDocumentEditRights: {0}, IsClpBlockedByAppSpecificScenario: {1}",Ga.AFrameworkApplication.ha.sa("HasDocumentEditRights"),Ob);Ga.AFrameworkApplication.xa.updateCommandUI()};E.prototype.QKd=function(Ob,yc){this.tTe(yc.title,yc.Ekc,38,yc.nkf,yc.buttonText);ea.ULS.sendTraceTag(34174784,306,10,"Failed to add entry to business bar. Policy message could not be shown to user.")};
E.prototype.fPh=function(Ob,yc){if(yc.sTf){Ob=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarTitle;var id=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarMessage,Tc=null,od=null;Ga.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CommonBusinessBarEntryForSensitivityLabelError",!1)?(Ob=yc.title,id=yc.message,Tc=yc.buttonText,od=yc.yX):1===yc.errorType?(Ob=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarTitle,id=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarMessage):
2===yc.errorType?(Ob=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarTitle,id=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarMessage):Ga.AFrameworkApplication.ha.sa("ClpLabelDisabledErrorCodeIsEnabled")&&3===yc.errorType?(Ob=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarTitle,id=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarMessage):4===yc.errorType?(Ob=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorTitle,
id=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorMessage):5===yc.errorType&&(Ob=yc.title,id=yc.message,Tc=yc.buttonText,od=yc.yX);this.tTe(Ob,id,21,null,null,od,Tc);ea.ULS.sendTraceTag(42074654,306,10,"Failed to add entry to business bar. CLP policy message could not be shown to user.")}};E.prototype.Gba=function(){};E.prototype.DUb=function(Ob,yc){this.j0&&(this.Wg.Gba(yc.emb),Ob=new Ka.a(yc.title,yc.message,null),Ob.id=yc.emb,Ob.closeable=!0,Ob.image=3,Ob.addButton(yc.buttonText,yc.yX,
yc.buttonText,!0),this.j0.fD(Ob,!1))};E.prototype.KOc=function(Ob,yc){this.j0&&(Ob=new Ka.a(yc.title,yc.message,null),Ob.id=yc.emb,Ob.closeable=!1,Ob.image=3,Ob.addButton(yc.buttonText,yc.yX,yc.buttonText,!1),this.j0.fD(Ob,!1))};E.prototype.EBd=function(){};E.prototype.tTe=function(Ob,yc,id,Tc,od,mc,Le){Tc=void 0===Tc?null:Tc;od=void 0===od?null:od;mc=void 0===mc?null:mc;Le=void 0===Le?null:Le;Ob=new Ka.a(Ob,yc,null);Ob.id=id;Ob.closeable=!0;Tc&&Ob.Zog(od,Tc);mc&&Ob.addButton(Le,mc,Le)};E.main=function(){rd.a.instance.ej(new E)};
Ll.Object.defineProperties(E.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.Policy"}}});Object(ab.a)(E,"PackageManager",null,[8,9]);var Id=b(12),Vd=b(675),He=b(212),Nd=b(58),Vc=b(35),fe=b(83),Ee=b(36),lf=b(306),Da=b(364),fc=b(161),Ib=b(92),Ta=b(27),kd=b(303),ce=b(1),dc=b(7),ub=b(275);Object(ab.a)(J,"ApplyPolicyContextParameters",null,[]);var pc=b(1397),xc=b(957),hd=b(43),Rc=b(42);Object(ab.a)(y,"AnnotationActivationOptions",null,[]);var ld=b(81),Wd=b(831),ee=b(804),
ne=Wd.a;Em(B,ne);B.getTypeName=function(){return"AugLoop_SecurityClp_LabellingAnnotation"};B.ke=function(){return["AugLoop_Core_Annotation"]};Object(ab.a)(B,"LabellingAnnotation",Wd.a,[]);var Ad=b(832),se=Ad.a;Em(t,se);t.getTypeName=function(){return"AugLoop_SecurityShared_SecurityShared"};t.ke=function(){return[]};Object(ab.a)(t,"SecurityShared",Ad.a,[]);Em(w,t);w.getTypeName=function(){return"AugLoop_SecurityShared_CLP"};w.ke=function(){return["AugLoop_SecurityShared_SecurityShared"]};Object(ab.a)(w,
"CLP",t,[]);var Ve=Wd.a;Em(v,Ve);v.getTypeName=function(){return"AugLoop_Automatic_Clp_LabellingAnnotation"};v.ke=function(){return["AugLoop_Core_Annotation"]};Object(ab.a)(v,"LabellingAnnotation",Wd.a,[]);var Zf=b(1110),Pf=b(1E3),Fe=b(1112),me=Wd.a;Em(h,me);h.getTypeName=function(){return"AugLoop_LinkedDataType_LinkedDataTypeAnnotation"};h.ke=function(){return["AugLoop_Core_Annotation"]};Object(ab.a)(h,"LinkedDataTypeAnnotation",Wd.a,[]);var ng=Ee.a;Em(r,ng);r.prototype.dispose=function(){this.disposed||
(this.disposed=!0,this.m1g(),this.Tye(),this.Fwd=this.policyManager=this.augmentationLoopManager=null,ng.prototype.dispose.call(this))};r.prototype.vWa=function(Ob,yc,id,Tc,od){od=void 0===od?!1:od;ea.ULS.sendTraceTag(537154642,306,50,"AutoPolicyManager: ApplyAutoPolicyLabel called for LabellingSource {0} with AutoLabelPresent: {1}, RecommendedLabelPresent: {2}, isStandard: {3}.",Tc,!dc.a.ma(Ob),!dc.a.ma(yc),od);this.lc?this.Fwd&&(ce.EwaSettings.isChangeGateEnabled("OfficeVSO:5317016_PowerBiRecommendationLabelFix")&&
(this.PHg(yc,Tc)?(this.Yxd=yc,this.Txd=Tc,this.Y$e.ia(Tc,yc)):yc=this.Yxd),Ob=this.Fwd.vWa(Ob,yc,id,od),ea.ULS.sendTraceTag(537154640,306,50,"AutoPolicyManager::ApplyAutoPolicyLabel - policyActor.ApplyAutoPolicyLabel returned {0}.",Ob)):ea.ULS.sendTraceTag(537154641,306,15,"AutoPolicyManager: ApplyAutoPolicyLabel failing because IsDisposed: {0}, IsSessionActive: {1}.",this.disposed,this.$.fa.lc)};r.prototype.PHg=function(Ob,yc){if(!this.policyManager.zfa())return ea.ULS.sendTraceTag(537154639,306,
15,"CanShowRecommendedSensitivityLabel - Labels are not available."),!1;var id=this.policyManager.an;var Tc=this.Y$e.zc(this.Txd).value;var od=null,mc=null,Le=null;id=Ol(id.SensitivityLabels);for(var we=id.next();!we.done;we=id.next())we=we.value,we.Id===Ob&&(od=we),we.Id===Tc&&(mc=we),we.Id===this.Yxd&&(Le=we);return mc&&mc.Id===Ob?(ea.ULS.sendTraceTag(537154638,306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since it is same as last recommendation from current source."),
!1):this.businessBar.tD(39)&&this.Txd!==yc&&Le&&(!od||Le.Order>=od.Order)?(ea.ULS.sendTraceTag(537154637,306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since current label priority is lower than last label priority."),!1):!0};r.prototype.igd=function(){return ce.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)};r.prototype.QPi=function(){this.policyManager.Vee(Object(ta.a)(this,this.FSf,"showAutoPolicyBusinessBar"));
this.policyManager.ige(Object(ta.a)(this,this.NDf,"removeAutoPolicyBusinessBar"));this.$.fa.j1(Object(ta.a)(this,this.P4,"onApplicationModeChanged"));this.igd()&&(this.policyManager.Rrg(Object(ta.a)(this,this.$_b,"createAutoCLPSecurityNodes")),this.policyManager.Oug(Object(ta.a)(this,this.F1f,"updateAutoCLPLabelPriorityNode")),this.policyManager.Pug(Object(ta.a)(this,this.G1f,"updateAutoCLPSITNodes")))};r.prototype.m1g=function(){this.businessBar.removeEntry(39);this.businessBar.removeEntry(38);this.policyManager.dTi(Object(ta.a)(this,
this.FSf,"showAutoPolicyBusinessBar"));this.policyManager.yVi(Object(ta.a)(this,this.NDf,"removeAutoPolicyBusinessBar"));this.$.fa.J5(Object(ta.a)(this,this.P4,"onApplicationModeChanged"));ce.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)&&(this.policyManager.LTi(Object(ta.a)(this,this.$_b,"createAutoCLPSecurityNodes")),this.policyManager.gWi(Object(ta.a)(this,this.F1f,"updateAutoCLPLabelPriorityNode")),this.policyManager.hWi(Object(ta.a)(this,this.G1f,"updateAutoCLPSITNodes")))};
r.prototype.YTh=function(){this.Az=new pc.a(xc.a.RL());var Ob=this.igd()?B.getTypeName():v.getTypeName();this.Az.add(1,Object.assign(new y,{annotationType:Ob,rWa:Object(ta.a)(this,this.K9h,"labellingAnnotationHandler"),dE:!1,HJa:!1}));this.Az.add(2,Object.assign(new y,{annotationType:h.getTypeName(),rWa:Object(ta.a)(this,this.Bai,"linkedDataTypeLabellingAnnnotationHandler"),dE:!1,HJa:!1}))};r.prototype.$_b=function(Ob,yc){Ob=Object.assign(new Zf.a,{parentPath:["session","doc","security"],items:[Object.assign(new Pf.a,
{id:"clp",body:Object.assign(new w,{existingLabelPriority:yc.existingLabelPriority,partialDocSITs:yc.Gre,fullDocSITs:yc.Fre})})]});this.c7a.push(Ob);this.Bub()};r.prototype.F1f=function(Ob,yc){Ob=Object.assign(new Fe.a,{parentPath:["session","doc","security"],items:[Object.assign(new Pf.a,{id:"clp",body:Object.assign(new w,{existingLabelPriority:yc.existingLabelPriority})})]});this.c7a.push(Ob);this.Bub()};r.prototype.G1f=function(Ob,yc){Ob=Object.assign(new Fe.a,{parentPath:["session","doc","security"],
items:[Object.assign(new Pf.a,{id:"clp",body:Object.assign(new w,{partialDocSITs:yc.Gre,fullDocSITs:yc.Fre})})]});this.c7a.push(Ob);this.Bub()};r.prototype.IWf=function(){for(var Ob=Ol(this.c7a),yc=Ob.next();!yc.done;yc=Ob.next())this.augmentationLoopManager.submitOperation(yc.value);this.c7a=[]};r.prototype.KPi=function(Ob){if(!this.Az.qb(Ob))return ea.ULS.sendTraceTag(537154636,306,15,"AutoPolicyManager::RegisterAnnotation - AnnotationActivationOptions not available for LabellingSource {0}.",Ob),
!1;if(this.Az.oa(Ob).dE)return ea.ULS.sendTraceTag(537154635,306,15,"AutoPolicyManager::RegisterAnnotation - Annotations already registered for LabellingSource {0}.",Ob),!0;this.Az.oa(Ob).dE=!0;ea.ULS.sendTraceTag(537154634,306,50,"AutoPolicyManager::RegisterAnnotation - Annotations registered for LabellingSource {0}.",Ob);if(!this.$.isEditMode)return ea.ULS.sendTraceTag(537154633,306,50,"AutoPolicyManager::RegisterAnnotation - Skipping AugmentationLoop initialization in view mode."),!0;ce.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",
!1)?this.Bub():this.Z0e();return!0};r.prototype.Z0e=function(){for(var Ob=this,yc=!1,id=Ol(this.Az),Tc=id.next();!Tc.done&&!(yc=Tc.value.value.dE||yc);Tc=id.next());yc?this.augmentationLoopManager?(ea.ULS.sendTraceTag(537154631,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop already initialized."),this.aUb()):this.PWa?ea.ULS.sendTraceTag(537154630,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop initialization in-progress."):
(this.PWa=!0,yc=this.$.ya.FlightingSettings.AutoCLPStartUpDelay,ea.ULS.sendTraceTag(537154629,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - Initializing AugmentationLoop in {0} milliseconds.",yc),hd.a.instance.create(function(){Ob.$Th()},yc,Rc.a.Xke,!0,!0)):ea.ULS.sendTraceTag(537154632,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - no registered annotations.")};r.prototype.Bub=function(){var Ob=this,yc=0<this.c7a.length;if(!yc)for(var id=
Ol(this.Az),Tc=id.next();!Tc.done&&!(yc=Tc.value.value.dE||yc);Tc=id.next());yc?this.augmentationLoopManager?(ea.ULS.sendTraceTag(537154627,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop already initialized."),this.aUb(),this.IWf()):this.PWa?ea.ULS.sendTraceTag(537154626,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop initialization in-progress."):(this.PWa=!0,yc=this.$.ya.FlightingSettings.AutoCLPStartUpDelay,ea.ULS.sendTraceTag(537154625,
306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - Initializing AugmentationLoop in {0} milliseconds.",yc),hd.a.instance.create(function(){Ob.aUh()},yc,Rc.a.Xke,!0,!0)):ea.ULS.sendTraceTag(537154628,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - no registered annotations and operations.")};r.prototype.aUh=function(){var Ob=this;Vc.TaskExtensions.Aa(Nd.GetServiceTaskFactory.Va(this.$.ea,328,327,1,"Microsoft.Office.Excel.WebUI.Client.AugmentationLoop.IAugmentationLoopManager"),
function(yc){Ob.augmentationLoopManager=yc.result;Ob.PWa=!1;Ob.augmentationLoopManager?(ea.ULS.sendTraceTag(537154595,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),Ob.augmentationLoopManager.xde(Object(ta.a)(Ob,Ob.Tjf,"onAugmentationLoopSessionClose")),Ob.$.isEditMode?(Ob.aUb(),Ob.IWf()):ea.ULS.sendTraceTag(537154594,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):ea.ULS.sendTraceTag(537154624,306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},
this.la,3)};r.prototype.$Th=function(){var Ob=this;Vc.TaskExtensions.Aa(Nd.GetServiceTaskFactory.Va(this.$.ea,328,327,1,"Microsoft.Office.Excel.WebUI.Client.AugmentationLoop.IAugmentationLoopManager"),function(yc){Ob.augmentationLoopManager=yc.result;Ob.PWa=!1;Ob.augmentationLoopManager?(ea.ULS.sendTraceTag(571479120,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),Ob.augmentationLoopManager.xde(Object(ta.a)(Ob,Ob.Tjf,"onAugmentationLoopSessionClose")),Ob.$.isEditMode?
Ob.aUb():ea.ULS.sendTraceTag(537154592,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):ea.ULS.sendTraceTag(537154593,306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},this.la,3)};r.prototype.Tye=function(){for(var Ob=Ol(this.Az),yc=Ob.next();!yc.done;yc=Ob.next())yc=yc.value,yc.value.dE&&this.l1g(yc.key)};r.prototype.l1g=function(Ob){this.Az.oa(Ob).HJa&&this.Pxe(Ob);this.Az.oa(Ob).dE=!1;ea.ULS.sendTraceTag(537154591,
306,50,"AutoPolicyManager::DeregisterAnnotation completed for LabellingSource {0}.",Ob)};r.prototype.aUb=function(){for(var Ob=Ol(this.Az),yc=Ob.next();!yc.done;yc=Ob.next())yc=yc.value,yc.value.dE&&!yc.value.HJa&&this.activateAnnotation(yc.key)};r.prototype.activateAnnotation=function(Ob){this.augmentationLoopManager.activateAnnotation(this.Az.oa(Ob).annotationType);this.augmentationLoopManager.h8(this.Az.oa(Ob).annotationType,this.Az.oa(Ob).rWa);this.Az.oa(Ob).HJa=!0;ea.ULS.sendTraceTag(537154590,
306,50,"AutoPolicyManager::ActivateAnnotation completed for LabellingSource {0}.",Ob)};r.prototype.E_g=function(){for(var Ob=Ol(this.Az),yc=Ob.next();!yc.done;yc=Ob.next())yc=yc.value,yc.value.HJa&&this.Pxe(yc.key)};r.prototype.Pxe=function(Ob){this.augmentationLoopManager.Cmc(this.Az.oa(Ob).annotationType,this.Az.oa(Ob).rWa);this.Az.oa(Ob).HJa=!1;ea.ULS.sendTraceTag(537154589,306,50,"AutoPolicyManager::DeactivateAnnotation completed for LabellingSource {0}.",Ob)};r.prototype.P4=function(){ea.ULS.sendTraceTag(537154588,
306,50,"AutoPolicyManager::OnApplicationModeChanged - isEditMode:{0}.",this.$.isEditMode);this.$.isEditMode?ce.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?this.Bub():this.Z0e():(this.businessBar.removeEntry(39),this.businessBar.removeEntry(38),this.E_g())};r.prototype.Tjf=function(){ea.ULS.sendTraceTag(537154587,306,50,"AutoPolicyManager::OnAugmentationLoopSessionClose called.");this.Tye();this.augmentationLoopManager=null};r.prototype.K9h=function(Ob,
yc){ea.ULS.sendTraceTag(537154586,306,50,"AutoPolicyManager::LabellingAnnotationHandler called.");if(3===yc.operationType)ea.ULS.sendTraceTag(537154585,306,50,"AutoPolicyManager::LabellingAnnotationHandler Ignoring delete operation.");else{var id=Ob=null,Tc=null;if(this.igd()){yc=yc.qX;if(!yc){ea.ULS.sendTraceTag(537154584,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");return}yc.automatic&&yc.automatic.id&&(Ob=yc.automatic.id);yc.recommended&&yc.recommended.id&&
(id=yc.recommended.id,yc.recommended.policyTip&&(Tc=yc.recommended.policyTip))}else{yc=yc.qX;if(!yc){ea.ULS.sendTraceTag(537154583,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");return}yc.automatic&&yc.automatic.sensitivityLabel&&yc.automatic.sensitivityLabel.id&&(Ob=yc.automatic.sensitivityLabel.id);yc.recommended&&yc.recommended.sensitivityLabel&&yc.recommended.sensitivityLabel.id&&(id=yc.recommended.sensitivityLabel.id,yc.recommended.sensitivityLabel.policyTip&&
(Tc=yc.recommended.sensitivityLabel.policyTip))}this.applyPolicyLabel(Ob,id,Tc,1)}};r.prototype.Bai=function(Ob,yc){ea.ULS.sendTraceTag(537154582,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Handler called.");3===yc.operationType?ea.ULS.sendTraceTag(537154581,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received delete operation."):(Ob=yc.qX)?(Ob=Ob.classificationId,this.applyPolicyLabel(Ob,Ob,null,2)):ea.ULS.sendTraceTag(537154580,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received an empty annotation.")};
r.prototype.applyPolicyLabel=function(Ob,yc,id,Tc){var od=this;if(this.ha.sa("SupportsOfficeClientCoauthoring"))ea.ULS.sendTraceTag(537154579,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is enabled."),this.vWa(Ob,yc,id,Tc);else{ea.ULS.sendTraceTag(537154578,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is disabled.");var mc=function(Le){od.vWa(Ob,yc,id,Tc,!Le||1===Le||4===Le)};this.Y$c(mc,function(){mc(2)},this.Vef)}};r.prototype.QRc=
function(Ob,yc){var id=this.W_f(Ob);Ob=id.sensitivityLabel;var Tc=id.eEa;if(!id.returnValue)return ea.ULS.sendTraceTag(537154577,306,15,"AutoApplyOrRecommendPolicyLabel - Failed to set the sensitivity labels."),!1;if(Tc&&Tc.Order>=Ob.Order)return ea.ULS.sendTraceTag(537154576,306,50,"AutoApplyOrRecommendPolicyLabel - The applied label has a higher sensitivty."),!1;this.applyPolicyLabel(Ob.Id,Ob.Id,null,yc);return!0};r.prototype.RRc=function(Ob,yc){var id=this;yc=!1;var Tc=null,od=null;if(!function(){var we=
id.W_f(Ob);Tc=we.sensitivityLabel;od=we.eEa;return we}().returnValue)return ea.ULS.sendTraceTag(537154575,306,15,"AutoApplyOrRecommendPowerBILabel - Failed to set the sensitivity labels."),{returnValue:!1,cKa:yc};if(od&&!dc.a.ma(od.ParentId)&&!dc.a.ma(Tc.ParentId)&&od.ParentId===Tc.ParentId)return ea.ULS.sendTraceTag(537154574,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label has a common parent with AppliedLabel."),{returnValue:!1,cKa:yc};if(od&&od.Order>=Tc.Order)return ea.ULS.sendTraceTag(537154573,
306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label does not have a higher priority than AppliedLabel."),{returnValue:!1,cKa:yc};if(this.ha.sa("SupportsOfficeClientCoauthoring")){ea.ULS.sendTraceTag(537154572,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is enabled.");var mc=this.policyManager.an;mc=dc.a.ma(mc.AppliedPolicyId)||!mc.PolicyLabelAssignmentMethod||tc.c(mc.PolicyLabelAssignmentMethod)===tc.c("standard");this.wje(Tc.Id,mc)}else{ea.ULS.sendTraceTag(537154571,
306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is disabled.");var Le=function(we){id.wje(Tc.Id,!we||1===we||4===we)};this.Y$c(Le,function(){Le(2)},this.Vef)}return{returnValue:!0,cKa:yc}};r.prototype.Y$c=function(Ob,yc,id,Tc){var od=this;Tc=void 0===Tc?0:Tc;if(this.lc){var mc=this.$.ra.ua.Wb();z(this.$.ra.ua,this.$.ya.DocumentHostInfo.TenantId,function(Le){od.fFh(Le,Ob)},function(){od.eFh(Ob,yc,id,Tc)},null,null,mc)}else ea.ULS.sendTraceTag(537154570,
306,15,"AutoPolicyManager: GetPolicyApplicationMethod failing because IsDisposed: {0}, IsSessionActive: {1}.",this.disposed,this.$.fa.lc)};r.prototype.fFh=function(Ob,yc){ea.ULS.sendTraceTag(537154569,306,50,"AutoPolicyManager: GetPolicyApplicationMethod web service call was successful.");this.lc?!Ob||kd.a(Ob)?ea.ULS.sendTraceTag(537154567,306,15,Ob?"AutoPolicyManager: GetPolicyApplicationMethod result has non-status message.":"AutoPolicyManager: GetPolicyApplicationMethod result is null"):yc(Ob.Result):
ea.ULS.sendTraceTag(537154568,306,50,"AutoPolicyManager: GetPolicyApplicationMethodSuccessCallback failing because IsDisposed: {0}, IsSessionActive: {1}.",this.disposed,this.$.fa.lc)};r.prototype.eFh=function(Ob,yc,id,Tc){ea.ULS.sendTraceTag(537154566,306,15,"AutoPolicyManager: GetPolicyApplicationMethod web service call failed. Trying again");this.lc?Tc>=id?(ea.ULS.sendTraceTag(537154564,306,15,"AutoPolicyManager: GetPolicyApplicationMethod max retries exhausted."),yc()):this.Y$c(Ob,yc,id,Tc+1):
ea.ULS.sendTraceTag(537154565,306,50,"AutoPolicyManager: GetPolicyApplicationMethodFailureCallback failing because IsDisposed: {0}, IsSessionActive: {1}.",this.disposed,this.$.fa.lc)};r.prototype.wje=function(Ob,yc){yc?this.vWa(Ob,null,null,3,!0):this.vWa(null,Ob,null,3,!1)};r.prototype.NDf=function(Ob,yc){yc?yc.lwb&&this.businessBar.tD(39)?(this.businessBar.removeEntry(39),ea.ULS.sendTraceTag(537154562,306,50,"Remove entry to RecommendedSensitivityLabelBusinessBarEntry succeeded.")):!yc.lwb&&this.businessBar.tD(38)&&
(this.businessBar.removeEntry(38),ea.ULS.sendTraceTag(537154561,306,50,"Remove entry to AutomaticSensitivityLabelBusinessBarEntry succeeded.")):ea.ULS.sendTraceTag(537154563,306,15,"RemoveAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};r.prototype.FSf=function(Ob,yc){var id=this;yc?yc.lwb?(this.businessBar.Lhj(yc.title,yc.message,yc.buttonText,function(Tc){yc.yX(Tc);id.businessBar.tD(39)&&id.businessBar.removeEntry(39)}),ea.ULS.sendTraceTag(537154531,306,50,
"Add entry to RecommendedSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):(this.businessBar.yfj(yc.title,yc.message,yc.buttonText,function(Tc){yc.yX(Tc);id.businessBar.tD(38)&&id.businessBar.removeEntry(38)}),ea.ULS.sendTraceTag(537154530,306,50,"Add entry to AutomaticSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):ea.ULS.sendTraceTag(537154560,306,15,"ShowAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};r.prototype.W_f=
function(Ob){var yc;var id=yc=null;if(!this.$.isEditMode)return{returnValue:!1,sensitivityLabel:yc,eEa:id};if(!this.policyManager.zfa())return ea.ULS.sendTraceTag(537154529,306,15,"TryGettingSensitivityLabels - Labels are not available."),{returnValue:!1,sensitivityLabel:yc,eEa:id};var Tc=this.policyManager.an;if(!Tc)return ea.ULS.sendTraceTag(537154528,306,15,"TryGettingSensitivityLabels - GetPolicyLabelsData returned an invalid result."),{returnValue:!1,sensitivityLabel:yc,eEa:id};if(rc.a.ma(Tc.SensitivityLabels))return ea.ULS.sendTraceTag(537154527,
306,15,"TryGettingSensitivityLabels - Attempting to apply labels when there are no sensitivity labels available."),{returnValue:!1,sensitivityLabel:yc,eEa:id};var od=Tc.AppliedPolicyId;Ob=Ol(Ob);for(var mc=Ob.next();!mc.done;mc=Ob.next()){mc=mc.value;for(var Le=Ol(Tc.SensitivityLabels),we=Le.next();!we.done;we=Le.next())we=we.value,we.Id===mc&&(!yc||yc.Order<we.Order)&&(yc=we),we.Id===od&&(id=we)}return yc?{returnValue:!0,sensitivityLabel:yc,eEa:id}:(ea.ULS.sendTraceTag(537154526,306,10,"TryGettingSensitivityLabels - None of the sensitivity labels matched."),
{returnValue:!1,sensitivityLabel:yc,eEa:id})};Ll.Object.defineProperties(r.prototype,{lc:{configurable:!0,enumerable:!0,get:function(){return!this.disposed&&this.$.fa.lc}}});Object(ab.a)(r,"AutoPolicyManager",Ee.a,[6]);var Oe=b(148),bd=b(11),ac=b(16),Fc=Oe.ErrorDialog;Em(n,Fc);n.prototype.Zl=function(){var Ob=this;Fc.prototype.Zl.call(this);if(this.error.Appearance&1&&this.$.zd&2){var yc=this.getButton(0);bd.DOMElementExtensions.rHd(yc.get_element(),ac.a.instance.da(1250));this.mO(function(){0===
Ob.returnValue&&Ob.$.zd&2&&(ea.ULS.sendTraceTag(50373725,306,50,"BlockSenitivityLabelActionDialog : Opening the book in excel desktop."),Vc.TaskExtensions.Aa(Nd.GetServiceTaskFactory.Va(Ob.$.ea,55,56,0,"Microsoft.Office.Excel.WebUI.Client.IOpenInExcelOperation"),function(id){id.result.Hte()},Ob.$.la,3))})}};n.xP=function(Ob){return Ob.zd&2?Ta.a.gd(3,1,0,1883,0,-1237306487,"SensitivityLabelBlockApplyLabelOpenInDesktop"):Ta.a.gd(1,1,0,1884,0,-313914360,"SensitivityLabelBlockApplyLabel")};Object(ab.a)(n,
"BlockSenitivityLabelActionDialog",Oe.ErrorDialog,[]);var Zc=Ee.a;Em(l,Zc);l.prototype.initialize=function(){var Ob=this;this.ha.sa("SupportsPolicies")&&(this.bCa=this.ha.Ta("AppliedPolicyId"),this.dV.Lg(),this.$.ea.$a(29,function(yc){Ob.statusBarManager=yc;yc.sI(Ob)}),this.jx(),ce.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CLPHostAuthenticationId",!1)&&dc.a.ma(this.ha.Ta("HostUserId"))||this.fGi(),this.dV.SPi(Object(ta.a)(this,this.VBg,"blockSetSensitivityCall")),this.dV.DQi(Object(ta.a)(this,
this.BZh,"isANewFile")),this.zr.OPi(Object(ta.a)(this,this.phd,"isEveryCoauthorInSessionClientMipTrusted")),this.Sn=ce.EwaSettings.getBooleanFeatureGate(lf.a.pNa,!1));ce.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CLPHostAuthenticationId",!1)&&dc.a.ma(this.ha.Ta("HostUserId"))||!ce.EwaSettings.ka(170)||!this.$.fa.$g.get(45)||(ea.ULS.sendTraceTag(537154524,306,50,"DataLossPrevention feature is Enabled and launched on Excel."),this.Cyh())};l.prototype.Qp=function(Ob){this.addHandler("LabelInfoChangedKey",
Ob)};l.prototype.jq=function(Ob){this.removeHandler("LabelInfoChangedKey",Ob)};l.prototype.Vm=function(){return!0};l.prototype.mr=function(Ob,yc){if("QueryPolicyLabel"!==Ob)return!1;if(this.BPa())return yc.Visible=!1,!0;yc.Visible=!0;return 32===Ga.AFrameworkApplication.Hb.Ge(Ia.a.k8a,2,yc)};l.prototype.dispose=function(){this.statusBarManager&&(this.statusBarManager.xE(this),this.statusBarManager=null);this.dV.PJb();this.MSc=!1;this.zr.OVi(Object(ta.a)(this,this.TTf,"showSetPolicyLabelFailureInBusinessBar"));
this.zr.PVi(Object(ta.a)(this,this.osf,"onSetLabelSucceeded"));this.$.fa.Qv(Object(ta.a)(this,this.uia,"handleWorkbookMetadataChanged"));if(this.ha.sa("SupportsOfficeClientCoauthoring")){var Ob=this.$.ea.Ba(292);Ob&&Ob.CUi(Object(ta.a)(this,this.Eof,"onLabelUpdate"))}this.zr.fTi(Object(ta.a)(this,this.aee,"addMandatoryLabellingBusinessBar"));this.zr.zVi(Object(ta.a)(this,this.lEf,"removeMandatoryLabellingBusinessBar"));this.zr.NUi(Object(ta.a)(this,this.Jef,"mandatoryLabellingHandler"));this.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.LabelHasUDPEnabled",
!1)&&this.zr.eWi(Object(ta.a)(this,this.u0f,"udpLabelingAppHandler"));ce.EwaSettings.ka(298)&&this.zr.jUi(Object(ta.a)(this,this.GCe,"enableAutoLabellingInDocument"));this.I8&&(this.I8.dispose(),this.I8=null);Zc.prototype.dispose.call(this)};l.prototype.QRc=function(Ob,yc){if(!this.ha.sa("SupportsPolicies"))return ea.ULS.sendTraceTag(537154523,306,15,"AutoApplyOrRecommendPolicyLabel - Called when SupportPolicies is disabled."),!1;if(!this.Gwd)return ea.ULS.sendTraceTag(537154522,306,15,"AutoApplyOrRecommendPolicyLabel - PolicyData hasn't been received yet."),
!1;if(rc.a.ma(Ob))return!1;this.I8||this.Sed();return this.I8.QRc(Ob,yc)};l.prototype.jx=function(){this.raiseEvent("LabelInfoChangedKey")};l.prototype.Cyh=function(){this.zr.b9c()};l.prototype.fGi=function(){var Ob=this;Pc.a.get_instance().Om(10,function(){Ob.zr.DPc(Object(ta.a)(Ob,Ob.OQd,"updateLabelInfo"));Ob.zr.wsg(Object(ta.a)(Ob,Ob.Bnf,"onGetPolicyLabelCompleted"));Ob.zr.vsg(Object(ta.a)(Ob,Ob.Bnf,"onGetPolicyLabelCompleted"));Ob.zr.ZPc(Object(ta.a)(Ob,Ob.TTf,"showSetPolicyLabelFailureInBusinessBar"));
Ob.zr.vge(Object(ta.a)(Ob,Ob.osf,"onSetLabelSucceeded"));Ob.$.fa.Vs(Object(ta.a)(Ob,Ob.uia,"handleWorkbookMetadataChanged"));Ob.zr.Wee(Object(ta.a)(Ob,Ob.aee,"addMandatoryLabellingBusinessBar"));Ob.zr.jge(Object(ta.a)(Ob,Ob.lEf,"removeMandatoryLabellingBusinessBar"));Ob.zr.etg(Object(ta.a)(Ob,Ob.Jef,"mandatoryLabellingHandler"));Ob.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.LabelHasUDPEnabled",!1)&&Ob.zr.Lug(Object(ta.a)(Ob,Ob.u0f,"udpLabelingAppHandler"));if(Ob.ha.sa("SupportsOfficeClientCoauthoring")){var yc=
Ob.$.ea.Ba(292);yc&&yc.Vsg(Object(ta.a)(Ob,Ob.Eof,"onLabelUpdate"))}ce.EwaSettings.ka(298)&&(ea.ULS.sendTraceTag(537154521,306,50,"PolicyManagerWrapper: ApplyAutomaticPolicyLabel enabled and registered GetAutoPolicyLabelHandler"),Ob.zr.usg(Object(ta.a)(Ob,Ob.GCe,"enableAutoLabellingInDocument")));Ob.Jkh()})};l.prototype.Jkh=function(){this.ha.sa("SupportsOfficeClientCoauthoring")||this.labelId&&this.labelId.length?this.C0a():this.auh(this.$.ya.DocumentHostInfo.TenantId)};l.prototype.GCe=function(){ea.ULS.sendTraceTag(537154520,
306,50,"PolicyManagerWrapper::EnableAutoLabellingInDocument - Triggered EnableAutoLabellingInDocument");var Ob=this.XCf(1);ea.ULS.sendTraceTag(537154519,306,50,"PolicyManagerWrapper::EnableAutoLabellingInDocument - Annotation registration result: {0}.",Ob)};l.prototype.Sed=function(){this.I8=new r(this.dV,this.zr,this.$,this.ha,this.mD)};l.prototype.XCf=function(Ob){if(!this.ha.sa("SupportsPolicies"))return ea.ULS.sendTraceTag(537154518,306,10,"PolicyManagerWrapper::RegisterAugmentationLoopAnnotations called when CLP is disabled."),
!1;this.I8||this.Sed();return this.I8.KPi(Ob)};l.prototype.RRc=function(Ob,yc){if(ce.EwaSettings.isChangeGateEnabled("OfficeVSO:5697254_ApplyPowerBiLabel")){if(!this.ha.sa("SupportsPolicies"))return ea.ULS.sendTraceTag(537154517,306,10,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called when CLP is disabled."),{returnValue:!1,cKa:!1};if(!this.Gwd)return ea.ULS.sendTraceTag(537154516,306,15,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called before PolicyData fetch is complete."),
{returnValue:!1,cKa:!0};this.I8||this.Sed();return this.I8.RRc(Ob,yc)}ea.ULS.sendTraceTag(537154515,306,10,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called when BRS ApplyPowerBiLabel is disabled.");return{returnValue:!1,cKa:!1}};l.prototype.auh=function(Ob){var yc=this;ea.ULS.sendTraceTag(537154514,306,50,"PolicyManagerWrapper: Doing GetPolicyLabelId web service call with tenantId length {0}",Ob.length);var id=this.$.ra.ua.Wb();x(this.$.ra.ua,Ob,function(Tc){yc.Xmj(Tc)},null,null,null,
id)};l.prototype.Xmj=function(Ob){ea.ULS.sendTraceTag(537154513,306,50,"PolicyManagerWrapper: GetPolicyLabelId web service call was successful");Ob&&!kd.a(Ob)&&(this.bCa=Ob.Result);this.C0a();this.labelId?ea.ULS.sendTraceTag(537154512,306,50,"PolicyManagerWrapper: Fetched LabelId length from custom.xml is {0}",this.labelId.length):ea.ULS.sendTraceTag(537154511,306,50,"PolicyManagerWrapper: LabelId is invalid")};l.prototype.C0a=function(){this.zr.a9c(this.labelId,void 0,void 0,!1)};l.prototype.QKd=
function(Ob,yc){yc?(this.Uo=yc.title,this.W6d=yc.Ekc,this.cea=yc.buttonText,this.Q5d=yc.nkf,this.mD.eg(27,null),ea.ULS.sendTraceTag(537154509,306,50,"Add entry to BusinessBar succeeded. Message is shown to user.")):ea.ULS.sendTraceTag(537154510,306,15,"ShowPolicyBusinessBar is called but PolicyTipventArgs is null.")};l.prototype.TTf=function(Ob,yc){var id=this,Tc=Object(fe.a)(aa,yc);Tc?Tc.sTf?this.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CommonBusinessBarEntryForSensitivityLabelError",
!1)?(ea.ULS.sendTraceTag(537154508,306,15,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of {0}",Tc.errorType),this.mD.Uhj(Tc.title,Tc.message,Tc.buttonText,function(od){Tc.yX&&(id.mD.tD(52)&&id.mD.removeEntry(52),Tc.yX(od))})):1===Tc.errorType?(ea.ULS.sendTraceTag(537154507,306,15,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of File too large"),this.mD.eg(47,null)):2===Tc.errorType?this.mD.eg(48,null):3===Tc.errorType?this.mD.eg(49,null):4===
Tc.errorType?this.mD.eg(50,null):5===Tc.errorType?this.mD.Vhj(Tc.title,Tc.message,Tc.buttonText,function(od){id.mD.tD(51)&&id.mD.removeEntry(51);Tc.yX(od)}):this.mD.eg(46,null):ea.ULS.sendTraceTag(537154506,306,50,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure ShowMessage is false"):(ea.ULS.sendTraceTag(537154505,306,10,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure args is null"),this.mD.eg(46,null))};l.prototype.OQd=function(Ob,yc){this.dV&&(ea.ULS.sendTraceTag(537154504,
306,50,"PolicyManagerWrapper: UpdateLabelInfo called"),this.dV.ePf(),this.dV.yOf(),this.dV.zzf(),this.$.zd&64&&(ce.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.DefaultAndMandatoryLabelingDecouplingEnabled",!1)?yc.onSuccess&&this.Ija?this.qje():this.dV.g_f():(yc.onSuccess&&this.Ija?this.qje():this.dV.m_f(),this.$.isEditMode?this.dV.kqc():Ga.AFrameworkApplication.nU||this.$.fa.j1(Object(ta.a)(this,this.f_f,"triggerDefaultLabelingOnModeChanged")))));this.ha.sa("SupportsOfficeClientCoauthoring")&&
(Ob=this.zr.an,this.bCa=Ob.AppliedPolicyId,"null"===this.labelId&&(this.bCa=""),this.rwc&&(Ob=Ob.PolicyLabelAssignmentMethod&&tc.c(Ob.PolicyLabelAssignmentMethod)===tc.c("standard")?4:2,this.applyPolicyLabel(this.labelId,Ob,!0,this.KGd)));this.NIe();this.jx()};l.prototype.Bnf=function(){this.Gwd=!0;this.NIe()};l.prototype.osf=function(Ob,yc){ea.ULS.sendTraceTag(42322116,306,50,"PolicyManagerWrapper.OnSetLabelSucceeded: Applying outcomes for change in policy label. ProtectedFile = {0}, ApplyLabelFlag = {1}",
Ga.AFrameworkApplication.protectedFile,yc.qO);this.applyPolicyLabel(yc.Dkc,yc.qO,!1,null)};l.prototype.NIe=function(){if(!this.MSc){this.$.zf();this.MSc=!0;this.mD.YXe();var Ob={};Ob.hasLabel=!!this.labelId&&0<this.labelId.length;Ob.isProtectedFile=this.ha.sa("ProtectedFile");Ob.SupportsPolicies=this.ha.sa("SupportsPolicies");Ob.AreLabelsAvailableForDisplay=this.zr.zfa();Ob.SupportsOfficeClientCoauthoring=this.ha.sa("SupportsOfficeClientCoauthoring");Ob.IsAnonymousUser=this.ha.sa("IsAnonymousUser");
ea.ULS.sendTraceTag(51238051,306,50,"CLPUsage : {0}",JSON.stringify(Ob))}};l.prototype.noi=function(Ob,yc){this.bCa=yc.Dkc;if(Ta.a.vq(Ob.Errors)){var id=Ta.a.N9(Ob.Errors,[2045508683]);0<id.length&&(Ob.Errors=Ta.a.yE(Ob.Errors,[2045508683],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),this.$.fa.Jo(Ob.Errors));id=Ta.a.N9(Ob.Errors,[2046680228]);0<id.length&&(4===yc.qO||1===yc.qO)&&(Ob.Errors=Ta.a.yE(Ob.Errors,[2046680228],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),
this.$.fa.Jo(Ob.Errors));id=Ob=null;for(var Tc=Ol(this.zr.an.SensitivityLabels),od=Tc.next();!od.done;od=Tc.next())od=od.value,dc.a.equals(this.labelId,od.Id,!1)&&(Ob=od),dc.a.equals(yc.DMf,od.Id,!1)&&(id=od);Tc={};Tc.ApplyLabelFlag=yc.qO;Ob?(Tc.currentLabel="Set",Tc.currentLabelEnabled=Ob.Enabled,Tc.currentLabelName=dc.a.ma(Ob.Name)?"NotSet":"Set",Tc.currentLabelParentId=dc.a.ma(Ob.ParentId)?"NotSet":"Set"):Tc.currentLabel="NotSet";id?(Tc.serverLabel="Set",Tc.serverLabelEnabled=id.Enabled,Tc.serverLabelName=
dc.a.ma(id.Name)?"NotSet":"Set",Tc.serverLabelParentId=dc.a.ma(id.ParentId)?"NotSet":"Set"):Tc.serverLabel="NotSet";ea.ULS.sendTraceTag(541638850,306,15,"PolicyManagerWrapper.OnApplyManualPolicyLabelSuccessCallback Failed. DiagnosticInfo : {0}",JSON.stringify(Tc))}};l.prototype.VBg=function(Ob,yc){if(!this.$.workbookContext.HasRoundTrippedHFPart)return!1;var id=this.zr.an;if(!id)return ea.ULS.sendTraceTag(537154502,306,15,"PolicyManagerWrapper.BlockSetSensitivityCall: policyLabelsData is null."),
!1;var Tc=null;id=Ol(id.SensitivityLabels);for(var od=id.next();!od.done;od=id.next())od=od.value,dc.a.equals(od.Id,Ob,!1)&&(Tc=od);return Tc&&this.FQh(Tc)?(ea.ULS.sendTraceTag(50341186,306,50,"PolicyManagerWrapper.BlockSetSensitivityCall: selectedSensitivityLabel has watermark label action."),this.HSf(yc),!0):!1};l.prototype.BZh=function(){var Ob=!1;!this.$.ya.IsNewWorkbook||this.labelId&&this.labelId.length||(Ob=!0);ea.ULS.sendTraceTag(537154501,306,50,"PolicyManagerWrapper.IsANewFile: is this a new file : {0}",
Ob);return Ob};l.prototype.Jef=function(Ob,yc){1===yc.eie?this.$.isEditMode?(ea.ULS.sendTraceTag(537154500,306,50,"MandatoryLabellingHandler : Swtiching to view-mode."),this.$.Ka.Ub(new Ib.a(-723527778,0,this.$.dd,10,null))):ea.ULS.sendTraceTag(537154499,306,50,"MandatoryLabellingHandler : App is already in view-mode."):(this.Ija=yc.Ija,this.$.fa.j1(Object(ta.a)(this,this.rje,"applyMandatoryLabelOnEditMode")),this.$.Qbb(),ea.ULS.sendTraceTag(537154498,306,50,"MandatoryLabellingHandler : Swtiching to edit-mode."),
this.$.Ka.Ub(new Ib.a(-8805455,0,this.$.dd,10,null)))};l.prototype.aee=function(Ob,yc){yc?(Ob=!!(this.$.zd&64),ea.ULS.sendTraceTag(537154496,306,50,"AddMandatoryLabellingBusinessBar User has edit permission : {0}",Ob),Ob&&(this.$.Qbb(),this.mD.$gj(yc.title,yc.message,yc.buttonText,function(id){yc.yX(id)}))):ea.ULS.sendTraceTag(537154497,306,15,"AddMandatoryLabellingBusinessBar is called but MandatoryLabellingAppHandlerEventArgs is null.")};l.prototype.lEf=function(){this.mD.tD(40)&&this.mD.removeEntry(40)};
l.prototype.u0f=function(Ob,yc){yc.Jdj&&this.HSf(!0)};l.prototype.rje=function(){dc.a.ma(this.Ija)||!this.$.isEditMode?ea.ULS.sendTraceTag(537154467,306,15,"ApplyMandatoryLabelOnEditMode : mandatoryPolicyId empty {0} , edit mode : {1}.",dc.a.ma(this.Ija),this.$.isEditMode):(this.$.fa.J5(Object(ta.a)(this,this.rje,"applyMandatoryLabelOnEditMode")),this.C0a())};l.prototype.f_f=function(){this.$.isEditMode?(this.$.fa.J5(Object(ta.a)(this,this.f_f,"triggerDefaultLabelingOnModeChanged")),this.C0a()):ea.ULS.sendTraceTag(537154466,
306,15,"TriggerDefaultLabelingOnModeChanged is not expected in View-mode. Mode.")};l.prototype.qje=function(){this.dV.Txg(this.Ija);this.Ija=null};l.prototype.FQh=function(Ob){Ob=Ol(Ob.LabelActions);for(var yc=Ob.next();!yc.done;yc=Ob.next())if(dc.a.equals(yc.value.Name,"ApplyWatermark",!1))return!0;return!1};l.prototype.HSf=function(Ob){Ob?(new n(this.$)).mf():ea.ULS.sendTraceTag(537154465,306,50,"PolicyManagerWrapper.showBlockApplyLabelDialogDialog: Watermark Dialog box called with showDialog set to false from autoapply.")};
l.prototype.uia=function(){var Ob=this.$.fa.qn;Ob&&!dc.a.equals(Ob.AppliedPolicyLabelId,this.labelId,!1)&&(ea.ULS.sendTraceTag(537154464,306,50,"PolicyManagerWrapper.HandleWorkbookMetadataChanged: Calling GetPolicyLabels to update statusbar and ribbon control."),ea.ULS.shipAssertTag(537154463,306,this.$.isEditMode,"PolicyManagerWrapper.HandleWorkbookMetadataChanged policyId cannot change in read-only mode, this can happen if right policy id is not read from server."),this.ha.sa("SupportsOfficeClientCoauthoring")&&
this.$.isEditMode&&(this.rwc=!0,this.KGd=Ob.AppliedPolicyLabelId),this.bCa=Ob.AppliedPolicyLabelId,this.C0a())};l.prototype.phd=function(){var Ob=!0;if(!this.$.fa.amIAlone)for(var yc=Ol(this.$.fa.tm),id=yc.next();!id.done;id=yc.next())if(!id.value.SupportsClientIsMipTrusted){Ob=!1;break}ea.ULS.sendTraceTag(537154462,306,50,"PolicyManagerWrapper.IsEveryCoauthorInSessionClientMipTrusted : {0}",Ob);return Ob};l.prototype.Eof=function(){ea.ULS.sendTraceTag(537154461,306,50,"PolicyManagerWrapper.OnLabelUpdate: RTC notification received");
this.rwc=!0;this.C0a()};l.prototype.applyPolicyLabel=function(Ob,yc,id,Tc){var od=this,mc=Od.c(this.zr.an);if(void 0===Ob||null===Ob)Ob="";var Le=new J;Le.Dkc=Ob;Le.DMf=Tc;Le.qO=yc;var we=this.$.ra.ua;Da.a(this.$.userOperationManager,function(za,Nb,bb){Nb=Ob;var Ub=od.$.ya.DocumentHostInfo.TenantId;za=ub.b.call(null,Object(ta.a)(od,od.noi,"onApplyManualPolicyLabelSuccessCallback"),za);var kc=we.Na(41,null);kc.labelsInfoJson=mc;kc.appliedLabelId=Nb;kc.tenantId=Ub;kc.applyLabelFlag=yc;kc.skipApplyOutcomes=
id;return ld.i(we,"ApplyPolicyLabel",kc,za,null,bb,Le,0)},function(za){return new fc.a(222,0,za)},null);this.rwc=!1;this.KGd=null};l.prototype.BPa=function(){var Ob=this.$.ea.Ba(478);return this.Sn&&Ob?Ob.Sn():!1};Ll.Object.defineProperties(l.prototype,{title:{configurable:!0,enumerable:!0,get:function(){return this.Uo}},Ekc:{configurable:!0,enumerable:!0,get:function(){return this.W6d}},linkText:{configurable:!0,enumerable:!0,get:function(){return this.cea}},Evi:{configurable:!0,enumerable:!0,get:function(){return this.Q5d}},
labelId:{configurable:!0,enumerable:!0,get:function(){return this.bCa}}});Object(ab.a)(l,"PolicyManagerWrapper",Ee.a,[156,157,316]);var pd=He.a;Em(d,pd);d.prototype.create=function(){var Ob=this,yc=Nd.GetServiceTaskFactory.Va(this.$.ea,5,4,this.rb,"Microsoft.Office.Excel.WebUI.Client.BusinessBar.IBusinessBarManager"),id=Ga.AFrameworkApplication.Cd,Tc=Ga.AFrameworkApplication.ha;Vc.TaskExtensions.Aa(yc,function(){try{var od=new Vd.a(function(){return new A(Tc,id,Ga.AFrameworkApplication.xa.MC,Ob.$.ya.MaxGetPolicyRetries,
Zb.a.instance.oc("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"))}),mc=new Vd.a(function(){return new na(Ga.AFrameworkApplication.Hb,Ga.AFrameworkApplication.xa,Ga.AFrameworkApplication.ha,od)}),Le=Ob.$.ea.Ba(274);Le||(Le=new l(od.value,mc.value,yc.result,Ob.$,Ga.AFrameworkApplication.ha),Le.initialize());Ob.Eb(Le)}catch(we){throw ea.ULS.sendTraceTag(537154525,306,10,"PolicyManager was not created successfully [Exception: {0}]",we.toString()),we;}},this.la,3)};d.ja=function(Ob){Ob.ea.Ia(275,
new d(Ob))};Object(ab.a)(d,"PolicyManagerFactory",He.a,[]);var bf=b(800),Bd=b(173);e.prototype.Wc=function(){return!1};e.prototype.executeCommand=function(Ob,yc,id){switch(yc.command){case Ia.a.setSensitivity:return this.$.workbookContext.FileCoauthorable||(id[ma.NQc]=this.$.workbookContext.ExclusiveLockId),Ob=Ga.AFrameworkApplication.Hb.Ge(Ia.a.setSensitivity,2,id),qb.Task.Ra(32===Ob);case Ia.a.r5:return Ob=Ga.AFrameworkApplication.Hb.Ge(Ia.a.r5,2,id),qb.Task.Ra(32===Ob);case Ia.a.s5:return Ob=Ga.AFrameworkApplication.Hb.Ge(Ia.a.s5,
2,id),qb.Task.Ra(32===Ob);default:return Bd.a(yc.command)}};e.prototype.Ec=function(Ob,yc){switch(yc.command){case Ia.a.setSensitivity:case Ia.a.r5:case Ia.a.s5:return!0;default:return!1}};e.prototype.Yc=function(Ob,yc,id){switch(yc){case "PopulateSensitivityFlyout":return 32===Ga.AFrameworkApplication.Hb.Ge(Ia.a.jxa,2,id);default:return!1}};Object(ab.a)(e,"SensitivityCommandHandler",null,[160]);var Qe=bf.a;Em(a,Qe);a.prototype.Gd=function(){this.Ad([new e(this.$)])};a.ja=function(Ob){bf.a.Yd(316,
new a(Ob))};Object(ab.a)(a,"SensitivityCommandHandlerFactory",bf.a,[]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.Policy.Contracts");Type.registerNamespace("Common.App.Policy");E.main();(function(){Id.a.Ga(function(Ob){d.ja(Ob);a.ja(Ob)})})()}}]);

//# sourceMappingURL=EwaDS.policy.js.map